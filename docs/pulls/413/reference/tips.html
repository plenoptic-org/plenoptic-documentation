
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tips and Tricks &#8212; plenoptic 1.3.2.dev318 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d54d67fd" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=d26ac43e"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=6dbb43f8"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reference/tips';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.plenoptic.org/docs/branch/main/_static/version_switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.3.2';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <script src="../_static/custom-icon.js?v=0bae05a2"></script>
    <link rel="icon" href="../_static/plenoptic.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reproducibility and Compatibility" href="reproducibility.html" />
    <link rel="prev" title="Model requirements" href="models.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.3.2" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Plenoptic_Logo_CMYK_Full_Wide.svg" class="logo__image only-light" alt="plenoptic 1.3.2.dev318 documentation - Home"/>
    <img src="../_static/Plenoptic_Logo_CMYK_Full_DarkMode_Wide.svg" class="logo__image only-dark pst-js-only" alt="plenoptic 1.3.2.dev318 documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Reference
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/plenoptic-org/plenoptic/releases">
    Changelog
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../developers/index.html">
    For developers
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://plenoptic.org" title="Home" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-house fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Home</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/plenoptic-org/plenoptic" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/plenoptic" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/plenoptic-org/plenoptic/releases">
    Changelog
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developers/index.html">
    For developers
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://plenoptic.org" title="Home" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-house fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Home</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/plenoptic-org/plenoptic" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/plenoptic" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="models.html">Model requirements</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="reproducibility.html">Reproducibility and Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation Guide and Bibliography</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Reference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tips and Tricks</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tips-and-tricks">
<span id="tips-doc"></span><h1>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Link to this heading">#</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#why-does-synthesis-take-so-long" id="id2">Why does synthesis take so long?</a></p></li>
<li><p><a class="reference internal" href="#optimization-is-hard" id="id3">Optimization is hard</a></p>
<ul>
<li><p><a class="reference internal" href="#tweaking-the-model" id="id4">Tweaking the model</a></p></li>
<li><p><a class="reference internal" href="#my-synthesis-procedure-is-getting-stuck" id="id5">My synthesis procedure is getting stuck</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#none-of-the-existing-synthesis-methods-meet-my-needs" id="id6">None of the existing synthesis methods meet my needs</a></p></li>
</ul>
</nav>
<section id="why-does-synthesis-take-so-long">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Why does synthesis take so long?</a><a class="headerlink" href="#why-does-synthesis-take-so-long" title="Link to this heading">#</a></h2>
<p>Synthesis can take a while to run, especially if you are trying to synthesize a large image or using a complicated model. The following might help:</p>
<ul class="simple">
<li><p>Reducing the amount of time your model’s forward pass takes is the easiest way to reduce the overall duration of synthesis, as the forward pass is called many, many times over synthesis. Try using python’s <a class="reference external" href="https://docs.python.org/3/library/profile.html">built-in profiling tools</a> to check which part of your model’s forward pass is taking the longest, and try to make those parts more efficient. Jupyter also has nice <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">profiling tools</a>. For example, if you have for loops in your code, try and replace them with matrix operations and <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.einsum.html">einsum</a>.</p></li>
<li><p>If you have access to a GPU, use it! If your inputs are on the GPU before initializing the synthesis methods, the synthesis methods will also make use of the GPU. You can also move the <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>’s synthesis methods and models over to the GPU after initialization using the <code class="docutils literal notranslate"><span class="pre">to</span></code> <!-- skip-lint --> method.</p></li>
<li><p>Parallelize! When using plenoptic’s synthesis method for an experiment, you will probably need to synthesize a large number of images. Doing so is <a class="reference external" href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">embarrassingly parallel</a> — synthesizing a given image has no dependence on synthesizing any other image. Therefore, you can run many synthesis processes simultaneously. If you have access to a high performance computing cluster, you can often run 100s of jobs simultaneously, which will greatly reduce the amount of time required to synthesize a full set of images.</p></li>
<li><p>PyTorch appears to greedily grab more <a class="reference external" href="https://en.wikipedia.org/wiki/Thread_(computing)">threads</a> than are helpful. This can slow you down, especially if you are running many CPU-only jobs in parallel, and if you’re using LBFGS. It can thus be helpful to restrict the number of threads each process has access to, using <a class="reference external" href="https://docs.pytorch.org/docs/stable/generated/torch.set_num_threads.html#torch.set_num_threads" title="(in PyTorch v2.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.set_num_threads</span></code></a> and the <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code> environment variable. See <a class="reference internal" href="../user_guide/models_and_metrics/portilla_simoncelli/technical_details/ps_optimization.html#threads"><span class="std std-ref">Parallelism and CPU efficiency</span></a> for more information, including how to do so.</p></li>
<li><p>PyTorch’s <a class="reference external" href="https://docs.pytorch.org/tutorials/recipes/recipes/tuning_guide.html">performance tuning guide</a> has lots of helpful tips, so it’s worth a read.</p></li>
</ul>
</section>
<section id="optimization-is-hard">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Optimization is hard</a><a class="headerlink" href="#optimization-is-hard" title="Link to this heading">#</a></h2>
<p>You should double-check whether synthesis has successfully completed before interpreting the outputs or using them in any experiments. This is not necessary for eigendistortions (see its <a class="reference internal" href="../user_guide/synthesis/Eigendistortions.html#eigendistortion-nb"><span class="std std-ref">notebook</span></a> for more details on why), but is necessary for all the iterative optimization methods.</p>
<ul class="simple">
<li><p>For metamers, this means double-checking that the difference between the model representation of the metamer and the target image is small enough. If your model’s representation is multi-scale, trying coarse-to-fine optimization may help (see <a class="reference internal" href="../user_guide/synthesis/Metamer.html#metamer-coarse-to-fine"><span class="std std-ref">notebook</span></a> for details).</p></li>
<li><p>For MAD competition, this means double-checking that the reference metric is constant and that the optimized metric has converged at a lower or higher value (depending on the value of <code class="docutils literal notranslate"><span class="pre">synthesis_target</span></code>); use <a class="reference internal" href="../api/generated/plenoptic.synthesize.mad_competition.plot_synthesis_status.html#plenoptic.synthesize.mad_competition.plot_synthesis_status" title="plenoptic.synthesize.mad_competition.plot_synthesis_status"><code class="xref py py-func docutils literal notranslate"><span class="pre">plot_synthesis_status</span></code></a> to visualize these values. You will likely need to spend time trying out different values for the <code class="docutils literal notranslate"><span class="pre">metric_tradeoff_lambda</span></code> argument set during initialization to achieve this.</p></li>
</ul>
<p>For all of the above, if synthesis has not found a good solution, you may need to run synthesis longer, use a learning-rate scheduler, change the learning rate, or try different optimizers. Each optimized synthesis method’s <code class="docutils literal notranslate"><span class="pre">objective_function</span></code> <!-- skip-lint --> method captures the value that we are trying to minimize, but may be influenced by other values (such as the penalty on allowed range values).</p>
<p>See <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues/365">Issue #365</a> for an example of how we worked through finding a good optimization configuration for the <a class="reference internal" href="../api/generated/plenoptic.simulate.models.portilla_simoncelli.PortillaSimoncelli.html#plenoptic.simulate.models.portilla_simoncelli.PortillaSimoncelli" title="plenoptic.simulate.models.portilla_simoncelli.PortillaSimoncelli"><code class="xref py py-class docutils literal notranslate"><span class="pre">PortillaSimoncelli</span></code></a> model.</p>
<p>In that investigation, we found that the <a class="reference external" href="https://docs.pytorch.org/docs/stable/generated/torch.optim.LBFGS.html#torch.optim.LBFGS" title="(in PyTorch v2.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LBFGS</span></code></a> optimizer performs very well, finding good solutions in a relatively short amount of time. We have not had the opportunity to investigate this optimizer in other problems, but we recommend giving it a try.</p>
<p>Additionally, it may be helpful to visualize the progression of synthesis, using each synthesis method’s <code class="docutils literal notranslate"><span class="pre">animate</span></code> <!-- skip-lint --> or <code class="docutils literal notranslate"><span class="pre">plot_synthesis_status</span></code> <!-- skip-lint --> helper functions (e.g., <a class="reference internal" href="../api/generated/plenoptic.synthesize.metamer.animate.html#plenoptic.synthesize.metamer.animate" title="plenoptic.synthesize.metamer.animate"><code class="xref py py-func docutils literal notranslate"><span class="pre">animate</span></code></a>, <a class="reference internal" href="../api/generated/plenoptic.synthesize.metamer.plot_synthesis_status.html#plenoptic.synthesize.metamer.plot_synthesis_status" title="plenoptic.synthesize.metamer.plot_synthesis_status"><code class="xref py py-func docutils literal notranslate"><span class="pre">plot_synthesis_status</span></code></a>).</p>
<section id="tweaking-the-model">
<span id="tips-model-tweak"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink">Tweaking the model</a><a class="headerlink" href="#tweaking-the-model" title="Link to this heading">#</a></h3>
<p>You can also improve your chances of finding a good synthesis by tweaking the model. For example, the loss function used for metamer synthesis by default is mean-squared error. This implicitly weights all aspects of the model’s representation equally. Thus, if there are portions of the representation whose magnitudes are significantly smaller than the others, they might not be matched at the same rate as the others. You can address this using coarse-to-fine synthesis or picking a more suitable loss function, but it’s generally a good idea for all of a model’s representation to have roughly the same magnitude. You can do this in a variety of ways:</p>
<ul class="simple">
<li><p>Principled: compose your representation of statistics that you know lie within the same range. For example, use correlations instead of covariances (see the Portilla-Simoncelli model, and in particular <a class="reference internal" href="../user_guide/models_and_metrics/portilla_simoncelli/technical_details/ps_matlab_differences.html#ps-mat-diffs"><span class="std std-ref">how plenoptic’s implementation differs from matlab</span></a> for an example of this).</p></li>
<li><p>Empirical: measure your model’s representation on a dataset of relevant natural images and then use this output to z-score your model’s representation on each pass (see <span id="id1"><a class="reference internal" href="citation.html#id36" title="Corey M. Ziemba and Eero P. Simoncelli. Opposing effects of selectivity and invariance in peripheral vision. Nature Communications, jul 2021. URL: https://doi.org/10.1038/s41467-021-24880-5, doi:10.1038/s41467-021-24880-5.">Ziemba and Simoncelli, 2021</a></span> for an example; this is what the Van Hateren database is used for).</p></li>
<li><p>In the middle: normalize statistics based on their value in the original image (note: not the image the model is taking as input! this will likely make optimization very difficult). The <a class="reference internal" href="../api/generated/plenoptic.tools.optim.groupwise_relative_l2_norm_factory.html#plenoptic.tools.optim.groupwise_relative_l2_norm_factory" title="plenoptic.tools.optim.groupwise_relative_l2_norm_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">groupwise_relative_l2_norm_factory</span></code></a> function will perform this when computing the loss, and allows for further tweaking.</p></li>
<li><p>Hacky: try reweighting different components of your model representation so that optimization matches some statistics more closely than others (see the <a class="reference internal" href="../user_guide/models_and_metrics/portilla_simoncelli/technical_details/ps_optimization.html#ps-loss-function"><span class="std std-ref">Portilla-Simoncelli custom loss function</span></a> for an example). This can be useful if some part of your representation is more perceptually important than others.</p></li>
</ul>
<p>If you are computing a multi-channel representation, you may have a similar problem where one channel is larger or smaller than the others. Here, tweaking the loss function might be more useful. Using something like <code class="docutils literal notranslate"><span class="pre">logsumexp</span></code> (the log of the sum of exponentials, a smooth approximation of the maximum function) to combine across channels after using something like L2-norm to compute the loss within each channel might help.</p>
</section>
<section id="my-synthesis-procedure-is-getting-stuck">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">My synthesis procedure is getting stuck</a><a class="headerlink" href="#my-synthesis-procedure-is-getting-stuck" title="Link to this heading">#</a></h3>
<p>It is possible that, even after tweaking your model and trying a variety of different optimization configurations, your optimization is still converging with a weirdly high loss. One possible reason for this is that different parts of your representation are trading off with each other, so that it’s hard to reduce error in one part of your representation without increasing it in another. In order to determine whether this is the case, it can be helpful to use the <a class="reference internal" href="../api/generated/plenoptic.synthesize.metamer.MetamerCTF.html#plenoptic.synthesize.metamer.MetamerCTF" title="plenoptic.synthesize.metamer.MetamerCTF"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetamerCTF</span></code></a> class, optimizing different components of the representation independently and then together (see <a class="reference internal" href="../user_guide/synthesis/Metamer.html#metamer-coarse-to-fine"><span class="std std-ref">Coarse-to-fine optimization</span></a> for more details about <a class="reference internal" href="../api/generated/plenoptic.synthesize.metamer.MetamerCTF.html#plenoptic.synthesize.metamer.MetamerCTF" title="plenoptic.synthesize.metamer.MetamerCTF"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetamerCTF</span></code></a>; this is equivalent to but perhaps more convenient than creating individual sub-models which return the different parts of the representation). If the loss is able to decrease with each component separately, but increases again when optimizing all of them together, your statistics are likely trading off against each other. If this is the case, then you can try removing the offending parts of your representation or reweighting them (see <a class="reference internal" href="../user_guide/models_and_metrics/portilla_simoncelli/technical_details/ps_optimization.html#ps-loss-function"><span class="std std-ref">Custom loss function</span></a>).</p>
<p>See the discussion of the variance of the highpass residuals and the min/max in <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues/365">Issue #365</a> for an example of how we worked through similar problems for the <a class="reference internal" href="../api/generated/plenoptic.simulate.models.portilla_simoncelli.PortillaSimoncelli.html#plenoptic.simulate.models.portilla_simoncelli.PortillaSimoncelli" title="plenoptic.simulate.models.portilla_simoncelli.PortillaSimoncelli"><code class="xref py py-class docutils literal notranslate"><span class="pre">PortillaSimoncelli</span></code></a> model.</p>
</section>
</section>
<section id="none-of-the-existing-synthesis-methods-meet-my-needs">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">None of the existing synthesis methods meet my needs</a><a class="headerlink" href="#none-of-the-existing-synthesis-methods-meet-my-needs" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> provides three synthesis methods, but you may find you wish to do something slightly outside the capabilities of the existing methods. There are generally two ways to do this: by tweaking your model or by extending one of the methods.</p>
<ul class="simple">
<li><p>See the Portilla-Simoncelli notebook on <a class="reference internal" href="../user_guide/models_and_metrics/portilla_simoncelli/advanced_usage/ps_extensions.html#ps-extensions"><span class="std std-ref">More than just texture metamers</span></a> for examples on how to get different metamer results by tweaking your model.</p></li>
<li><p>The coarse-to-fine optimization, discussed in the <a class="reference internal" href="../user_guide/synthesis/Metamer.html#metamer-coarse-to-fine"><span class="std std-ref">metamer notebook</span></a>, is an example of changing optimization by extending the <a class="reference internal" href="../api/generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer" title="plenoptic.synthesize.metamer.Metamer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Metamer</span></code></a> class.</p></li>
<li><p>The <a class="reference internal" href="../user_guide/advanced/Synthesis_extensions.html#synthesis-extensions"><span class="std std-ref">Synthesis extensions notebook</span></a> contains a discussion focused on this as well.</p></li>
</ul>
<p>If you extend a method successfully or would like help making it work, please let us know by posting a <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/discussions">discussion!</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="models.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model requirements</p>
      </div>
    </a>
    <a class="right-next"
       href="reproducibility.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reproducibility and Compatibility</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-synthesis-take-so-long">Why does synthesis take so long?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimization-is-hard">Optimization is hard</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tweaking-the-model">Tweaking the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#my-synthesis-procedure-is-getting-stuck">My synthesis procedure is getting stuck</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#none-of-the-existing-synthesis-methods-meet-my-needs">None of the existing synthesis methods meet my needs</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2019-2025, Plenoptic authors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>