

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Understanding Portilla-Simoncelli model statistics &mdash; plenoptic 1.3.2.dev217 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=9c3e77be" />
      <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=a2d047e6" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=4ba52da5"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=6dbb43f8"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../../_static/togglebutton.js?v=1ae7504c"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
      <script type="application/vnd.jupyter.widget-state+json">{"state": {"7a4eedb641584ce5ba35d47a0d85dc8e": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": "2", "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "666e7c3d98a34785a802a221e3ceeff8": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "e3b9f2ee4eac425fa8fb7bacf7f7bc3b": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "danger", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_7a4eedb641584ce5ba35d47a0d85dc8e", "max": 1.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_666e7c3d98a34785a802a221e3ceeff8", "tabbable": null, "tooltip": null, "value": 0.0}}, "d35d359ee39b400e909c17f4eecd9185": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "55200f739cbb41a6b6f43e3d703eb432": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "9704e00b13c44dffa1296910f90b2878": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_d35d359ee39b400e909c17f4eecd9185", "placeholder": "\u200b", "style": "IPY_MODEL_55200f739cbb41a6b6f43e3d703eb432", "tabbable": null, "tooltip": null, "value": "\u2007\u20070%"}}, "5aa56676383f4ba188f79e2314480b50": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fb5c425f983d4aa3ac06b5460534f66e": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "13ab9766b43a41658af96e56e95bfa54": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_5aa56676383f4ba188f79e2314480b50", "placeholder": "\u200b", "style": "IPY_MODEL_fb5c425f983d4aa3ac06b5460534f66e", "tabbable": null, "tooltip": null, "value": "\u20070.00/1.00\u2007[00:00&lt;?,\u2007?B/s]"}}, "15ae86e996a344afbb3cb3c4bb7c8b38": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": "inline-flex", "flex": null, "flex_flow": "row wrap", "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": "79px"}}, "8a461083cf8a41b19f5ec455db6f0a35": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_9704e00b13c44dffa1296910f90b2878", "IPY_MODEL_e3b9f2ee4eac425fa8fb7bacf7f7bc3b", "IPY_MODEL_13ab9766b43a41658af96e56e95bfa54"], "layout": "IPY_MODEL_15ae86e996a344afbb3cb3c4bb7c8b38", "tabbable": null, "tooltip": null}}, "828caa48e36549f38096e45e5b3c4ae5": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": "2", "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "c8c7dba459994cf2a9f083c42bd0e84e": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "ac8f4c8a447142c59ab7e4f0c2d6b17a": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "danger", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_828caa48e36549f38096e45e5b3c4ae5", "max": 1.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_c8c7dba459994cf2a9f083c42bd0e84e", "tabbable": null, "tooltip": null, "value": 0.0}}, "0ad6b6673e7c43d7bcd43e03d6b5b4d8": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0650f92752464aa7aab8c7478ed261fb": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "4f5df82d7d8e4e82bb45010868a70d5f": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_0ad6b6673e7c43d7bcd43e03d6b5b4d8", "placeholder": "\u200b", "style": "IPY_MODEL_0650f92752464aa7aab8c7478ed261fb", "tabbable": null, "tooltip": null, "value": "\u2007\u20070%"}}, "e7476a872fbb4234bde63f405682858d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3b9794ed2ea2458194341b09f1b4e410": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "409fcb393a464decbe98eb8d7e2e516c": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_e7476a872fbb4234bde63f405682858d", "placeholder": "\u200b", "style": "IPY_MODEL_3b9794ed2ea2458194341b09f1b4e410", "tabbable": null, "tooltip": null, "value": "\u20070.00/1.00\u2007[00:00&lt;?,\u2007?B/s]"}}, "0f588616829f4952bc032eafd1fa0c98": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": "inline-flex", "flex": null, "flex_flow": "row wrap", "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": "79px"}}, "7dd5381bdeb64737982c11561690be28": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_4f5df82d7d8e4e82bb45010868a70d5f", "IPY_MODEL_ac8f4c8a447142c59ab7e4f0c2d6b17a", "IPY_MODEL_409fcb393a464decbe98eb8d7e2e516c"], "layout": "IPY_MODEL_0f588616829f4952bc032eafd1fa0c98", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}</script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Portilla-Simoncelli optimization details" href="ps_optimization.html" />
    <link rel="prev" title="Example Portilla-Simoncelli metamers from different texture classes" href="ps_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            plenoptic
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basic concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jupyter.html">Using Jupyter to Run Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conceptual_intro.html">Conceptual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">Model requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../citation.html">Citation Guide and Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Synthesis method introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/Eigendistortions.html">Eigendistortions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/MAD_Competition_1.html">MAD Competition Conceptual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/MAD_Competition_2.html">MAD Competition Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/Metamer.html">Metamers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models and metrics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Perceptual_distance.html">Perceptual distance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Steerable_Pyramid.html">Steerable Pyramid</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ps_index.html">Portilla-Simoncelli Texture Model</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ps_intro.html">What is a visual texture?</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_basic_synthesis.html">Using the Portilla-Simoncelli model in plenoptic</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_examples.html">Example Portilla-Simoncelli metamers from different texture classes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Understanding Portilla-Simoncelli model statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_optimization.html">Portilla-Simoncelli optimization details</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_limitations.html">Portilla-Simoncelli Model Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_matlab_differences.html">Notable differences between Matlab and Plenoptic Implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_extensions.html">More than just texture metamers</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Synthesis method examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../applications/Demo_Eigendistortion.html">Reproducing Berardino et al., 2017 (Eigendistortions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/Original_MAD.html">Reproducing Wang and Simoncelli, 2008 (MAD Competition)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reproducibility.html">Reproducibility and Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/Display.html">Display and animate functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/Synthesis_extensions.html">Extending existing synthesis objects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../synthesis.html">Synthesis object design</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">plenoptic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="ps_index.html">Portilla-Simoncelli Texture Model</a></li>
      <li class="breadcrumb-item active">Understanding Portilla-Simoncelli model statistics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/tutorials/models/portilla_simoncelli/ps_understand_stats.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pooch</span>

<span class="c1"># don&#39;t need to show warning about setting up optimizer</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
    <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;You will need to call setup&quot;</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># don&#39;t have pooch output messages about downloading or untarring</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">pooch</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s2">&quot;WARNING&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="important admonition">
<p class="admonition-title">Download</p>
<p>Download this notebook: <strong><a class="reference download internal" download="" href="../../../_downloads/ce98980f84f85932ff1399f387420a67/ps_understand_stats.ipynb"><code class="xref download myst-nb docutils literal notranslate"><span class="pre">ps_understand_stats.ipynb</span></code></a></strong>!</p>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="understanding-portilla-simoncelli-model-statistics">
<span id="ps-model-stats"></span><h1>Understanding Portilla-Simoncelli model statistics<a class="headerlink" href="#understanding-portilla-simoncelli-model-statistics" title="Link to this heading"></a></h1>
<p>The Portilla-Simoncelli consists of a few different classes of statistics:</p>
<ul class="simple">
<li><p>Marginal Statistics.  These include pixel statistics (mean, variance, skew, kurtosis, and range of the pixel values), as well as the skewness and kurtosis of the lowpass images computed at each level of the recursive pyramid decomposition.</p></li>
<li><p>Auto-Correlation Statistics.  These include the auto-correlation of the real-valued <a class="reference internal" href="../Steerable_Pyramid.html#steer-pyr-bands"><span class="std std-ref">steerable pyramid bands</span></a>, as well as the auto-correlation of the magnitude of the pyramid bands, and the mean of the magnitude of the pyramid bands.</p></li>
<li><p>Cross-Correlation Statistics.  These include correlations across scale and across orientation bands of the steerable pyramid (both for the real values of the pyramid and for the magnitude of the pyramid bands).</p></li>
</ul>
<p>The original paper uses synthesis to demonstrate the role of these different types of statistics.  They show that the statistics can be used to constrain a synthesis optimization to generate new examples of textures.  They also show that the absence of subsets of statistics results in synthesis failures.  Here we replicate those results.</p>
<div class="warning dropdown admonition">
<p class="admonition-title">Reproducing the metamers in this notebook</p>
<p>Due to pytorch’s limitations, we <a class="reference internal" href="../../../reproducibility.html#reproduce"><span class="std std-ref">cannot guarantee perfect reproducibility</span></a>.
However, we’ve found the setup shown in this notebook works reliably across different images and produce good metamers efficiently.</p>
<p>If you use follow these basic steps and <strong>are not</strong> able to successfully synthesize a good <code class="docutils literal notranslate"><span class="pre">PortillaSimoncelli</span></code> <!-- skip-lint --> model metamer, please post on our <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/discussions/">discussion board</a> and we’ll try to help!</p>
<p>See <a class="reference internal" href="ps_optimization.html#ps-optimization"><span class="std std-ref">Portilla-Simoncelli optimization details</span></a> for more information about the specific decisions taken around optimization, including what “good” means.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">plenoptic</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">po</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="c1"># We need to download some additional images for this notebook.</span>
<span class="n">IMG_PATH</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fetch_data</span><span class="p">(</span><span class="s2">&quot;portilla_simoncelli_images.tar.gz&quot;</span><span class="p">)</span>
<span class="n">CACHE_DIR</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fetch_data</span><span class="p">(</span><span class="s2">&quot;ps_regression.tar.gz&quot;</span><span class="p">)</span>
<span class="c1"># use GPU if available</span>
<span class="n">DEVICE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="c1"># so that relative sizes of axes created by po.imshow and others look right</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">72</span>

<span class="c1"># set seed for reproducibility</span>
<span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="warning dropdown admonition">
<p class="admonition-title">This notebook retrieves cached synthesis results</p>
<p>This notebook contains many metamers and, while any one synthesis operation does not take too long, all of them combined result in a lengthy notebook. Therefore, instead of performing synthesis in this notebook, we have cached the result of most of these syntheses online and only download them for investigation.</p>
<p>Additionally, while you can normally call <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.synthesize" title="plenoptic.synthesize.metamer.Metamer.synthesize"><code class="xref py py-func docutils literal notranslate"><span class="pre">synthesize</span></code></a> again to pick up where we left out, the cached version of the results shown here discarded the optimizer’s state dict (to reduce the size on disk). Thus, calling <code class="docutils literal notranslate"><span class="pre">met.synthesize(100)</span></code> with one of our cached and loaded metamer objects <strong>will not</strong> give the same result as calling <code class="docutils literal notranslate"><span class="pre">met.synthesize(200)</span></code> with a new metamer object initialized as shown in this notebook.</p>
</div>
<p>In order to do reproduce those results, we create a version of the Portilla Simoncelli model where certain statistics can be turned off. If you are interested in the implementation, see the following dropdown.</p>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The following class extends the PortillaSimoncelli model so that you can specify</span>
<span class="c1"># which statistics you would like to remove.  We have created this model so that we</span>
<span class="c1"># can examine the consequences of the absence of specific statistics.</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PortillaSimoncelliRemove</span><span class="p">(</span><span class="n">po</span><span class="o">.</span><span class="n">simul</span><span class="o">.</span><span class="n">PortillaSimoncelli</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Model for measuring a subset of texture statistics reported by</span>
<span class="sd">    PortillaSimoncelli</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    im_shape: int</span>
<span class="sd">        the size of the images being processed by the model</span>
<span class="sd">    remove_keys: list</span>
<span class="sd">        The dictionary keys for the statistics we will &quot;remove&quot;.  In practice we set</span>
<span class="sd">        them to zero.</span>
<span class="sd">        Possible keys: [&quot;pixel_statistics&quot;, &quot;auto_correlation_magnitude&quot;,</span>
<span class="sd">        &quot;skew_reconstructed&quot;, &quot;kurtosis_reconstructed&quot;,</span>
<span class="sd">        &quot;auto_correlation_reconstructed&quot;, &quot;std_reconstructed&quot;, &quot;magnitude_std&quot;,</span>
<span class="sd">        &quot;cross_orientation_correlation_magnitude&quot;, &quot;cross_scale_correlation_magnitude&quot;,</span>
<span class="sd">        &quot;cross_scale_correlation_real&quot;, &quot;var_highpass_residual&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">im_shape</span><span class="p">,</span>
        <span class="n">remove_keys</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">im_shape</span><span class="p">,</span> <span class="n">n_scales</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">spatial_corr_width</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_keys</span> <span class="o">=</span> <span class="n">remove_keys</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate Texture Statistics representation of an image with `remove_keys`</span>
<span class="sd">        removed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        image : torch.Tensor</span>
<span class="sd">            A tensor containing the image to analyze.</span>
<span class="sd">        scales : list, optional</span>
<span class="sd">            Which scales to include in the returned representation. If an empty</span>
<span class="sd">            list (the default), we include all scales. Otherwise, can contain</span>
<span class="sd">            subset of values present in this model&#39;s scales attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        representation: torch.Tensor</span>
<span class="sd">            3d tensor of shape (batch, channel, stats) containing the measured texture</span>
<span class="sd">            stats.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create the representation tensor (with all scales)</span>
        <span class="n">stats_vec</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># convert to dict so it&#39;s easy to zero out the keys we don&#39;t care about</span>
        <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_dict</span><span class="p">(</span><span class="n">stats_vec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_keys</span><span class="p">:</span>
            <span class="c1"># we zero out the stats (instead of removing them) so that we can use all</span>
            <span class="c1"># the various helper functions (plot_representation, convert_to_dict,</span>
            <span class="c1"># convert_to_tensor) without any problems</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">OrderedDict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">stats_dict</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stats_dict</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">0</span>
        <span class="c1"># then convert back to tensor and remove any scales we don&#39;t want</span>
        <span class="c1"># (for coarse-to-fine)</span>
        <span class="n">stats_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scales</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stats_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_scales</span><span class="p">(</span><span class="n">stats_vec</span><span class="p">,</span> <span class="n">scales</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stats_vec</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="pixel-statistics-marginal-statistics">
<h2>Pixel Statistics + Marginal statistics<a class="headerlink" href="#pixel-statistics-marginal-statistics" title="Link to this heading"></a></h2>
<p>Beginning with some of the pixel and marginal statistics, we’ll demonstrate synthesis both with and without combinations of statistics.</p>
<p>To start, we’ll remove the following statistics:</p>
<ul class="simple">
<li><p>the pixel statistics: mean, variance, skew, kurtosis, minimum, and maximum of the original image.</p></li>
<li><p>skew and kurtosis on the lowpass images computed at each level of the recursive pyramid.</p></li>
</ul>
<p>These statistics play an important role constraining the histogram of pixel intensities to match across the original and synthesized image.</p>
<p>(See figure 3 of <span id="id1"><a class="reference internal" href="../../../citation.html#id27" title="Javier Portilla and Eero P Simoncelli. A parametric texture model based on joint statistics of complex wavelet coefficients. International journal of computer vision, 40(1):49–70, 2000.">Portilla and Simoncelli, 2000</a></span>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># which statistics to remove</span>
<span class="n">remove_statistics</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;pixel_statistics&quot;</span><span class="p">,</span>
    <span class="s2">&quot;skew_reconstructed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kurtosis_reconstructed&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># run on fig3a or fig3b to replicate paper</span>
<span class="n">fig_name</span> <span class="o">=</span> <span class="s2">&quot;fig3b&quot;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">load_images</span><span class="p">(</span><span class="n">IMG_PATH</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># synthesis with full PortillaSimoncelli model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">simul</span><span class="o">.</span><span class="n">PortillaSimoncelli</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">portilla_simoncelli_loss_factory</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="c1"># to avoid running so many syntheses in this notebook, we load a cached version. see the</span>
<span class="c1"># following admonition for how to run this yourself</span>
<span class="n">met</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-False.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>

<span class="c1"># synthesis with pixel and marginal statistics absent</span>
<span class="n">model_remove</span> <span class="o">=</span> <span class="n">PortillaSimoncelliRemove</span><span class="p">(</span>
    <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">remove_keys</span><span class="o">=</span><span class="n">remove_statistics</span>
<span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
<span class="n">loss_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">portilla_simoncelli_loss_factory</span><span class="p">(</span><span class="n">model_remove</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">met_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model_remove</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_remove</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met_remove</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-True.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="dropdown note admonition">
<p class="admonition-title">How to run these syntheses manually</p>
<!-- TestPortillaSimoncelli.test_ps_remove -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_iter&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;max_eval&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;line_search_fn&quot;</span><span class="p">:</span> <span class="s2">&quot;strong_wolfe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">met</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">,</span> <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="n">opt_kwargs</span><span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Call the <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.setup" title="plenoptic.synthesize.metamer.Metamer.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">setup</span></code></a> and <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.synthesize" title="plenoptic.synthesize.metamer.Metamer.synthesize"><code class="xref py py-func docutils literal notranslate"><span class="pre">synthesize</span></code></a> methods of <code class="docutils literal notranslate"><span class="pre">met_remove</span></code> with the same arguments.</p>
</div>
<p>In the following figure, we can see that not only does the metamer created with all statistics look more like the target image than the one created without the marginal statistics, but its pixel intensity histogram is much more similar to that of the target image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="p">[</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">,</span> <span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Target image&quot;</span><span class="p">,</span> <span class="s2">&quot;Full Statistics&quot;</span><span class="p">,</span> <span class="s2">&quot;Without Marginal Statistics&quot;</span><span class="p">],</span>
    <span class="n">vrange</span><span class="o">=</span><span class="s2">&quot;auto1&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># add plots showing the different pixel intensity histograms</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.33</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.67</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
<span class="c1"># this helper function expects a metamer object. see the metamer notebook for details.</span>
<span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">metamer</span><span class="o">.</span><span class="n">plot_pixel_values</span><span class="p">(</span><span class="n">met</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Full statistics&quot;</span><span class="p">)</span>
<span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">metamer</span><span class="o">.</span><span class="n">plot_pixel_values</span><span class="p">(</span><span class="n">met_remove</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Without marginal statistics&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Without marginal statistics&#39;)
</pre></div>
</div>
<img alt="../../../_images/ca1f7420435cfdcb68ae8180576625f24876d5fd3b067df72c4b61c3d0230e90.png" src="../../../_images/ca1f7420435cfdcb68ae8180576625f24876d5fd3b067df72c4b61c3d0230e90.png" />
</div>
</div>
</section>
<section id="coefficient-correlations">
<span id="ps-coeff-corrs"></span><h2>Coefficient Correlations<a class="headerlink" href="#coefficient-correlations" title="Link to this heading"></a></h2>
<p>In this section, we’ll replicate examples of synthesis failures with the following statistics removed:</p>
<ul class="simple">
<li><p>local auto-correlations of the lowpass images computed at each level of the recursive pyramid</p></li>
</ul>
<p>These statistics play a role in representing periodic structures and long-range correlations. For example, in the image named <code class="docutils literal notranslate"><span class="pre">fig4b.jpg</span></code> (the tile pattern) the absence of these statistics causes results in more difficulty synthesizing the long, continuous lines that stretch from one end of the image to the other.</p>
<p>(See figure 4 of <span id="id2"><a class="reference internal" href="../../../citation.html#id27" title="Javier Portilla and Eero P Simoncelli. A parametric texture model based on joint statistics of complex wavelet coefficients. International journal of computer vision, 40(1):49–70, 2000.">Portilla and Simoncelli, 2000</a></span>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># which statistics to remove. note that, in the original paper, std_reconstructed is</span>
<span class="c1"># implicitly contained within auto_correlation_reconstructed, view the section on</span>
<span class="c1"># differences between plenoptic and matlab implementation for details</span>
<span class="n">remove_statistics</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;auto_correlation_reconstructed&quot;</span><span class="p">,</span> <span class="s2">&quot;std_reconstructed&quot;</span><span class="p">]</span>

<span class="c1"># run on fig4a or fig4b to replicate paper</span>
<span class="n">fig_name</span> <span class="o">=</span> <span class="s2">&quot;fig4b&quot;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">load_images</span><span class="p">(</span><span class="n">IMG_PATH</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># We reuse the model and loss definition from the first section; the only difference</span>
<span class="c1"># is the image.</span>
<span class="n">met</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-False.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>

<span class="c1"># synthesis with coefficient correlations absent. we have to reinitialize the model and</span>
<span class="c1"># the loss because we&#39;re removing a different set of statistics.</span>
<span class="n">model_remove</span> <span class="o">=</span> <span class="n">PortillaSimoncelliRemove</span><span class="p">(</span>
    <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">remove_keys</span><span class="o">=</span><span class="n">remove_statistics</span>
<span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
<span class="n">loss_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">portilla_simoncelli_loss_factory</span><span class="p">(</span><span class="n">model_remove</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">met_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model_remove</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_remove</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met_remove</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-True.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="dropdown note admonition">
<p class="admonition-title">How to run these syntheses manually</p>
<!-- TestPortillaSimoncelli.test_ps_remove -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_iter&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;max_eval&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;line_search_fn&quot;</span><span class="p">:</span> <span class="s2">&quot;strong_wolfe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">met</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">,</span> <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="n">opt_kwargs</span><span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Call the <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.setup" title="plenoptic.synthesize.metamer.Metamer.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">setup</span></code></a> and <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.synthesize" title="plenoptic.synthesize.metamer.Metamer.synthesize"><code class="xref py py-func docutils literal notranslate"><span class="pre">synthesize</span></code></a> methods of <code class="docutils literal notranslate"><span class="pre">met_remove</span></code> with the same arguments.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize results</span>
<span class="n">po</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="p">[</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">,</span> <span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Target image&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Full Statistics&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Without Correlation Statistics&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">vrange</span><span class="o">=</span><span class="s2">&quot;auto1&quot;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/37e9ffb10269b0a503672615b57143ebaf75c43cf104f75fd253542fb1ae54d4.png" src="../../../_images/37e9ffb10269b0a503672615b57143ebaf75c43cf104f75fd253542fb1ae54d4.png" />
</div>
</div>
<p>And we can double check the error plots to see the difference in their representations. The first figure shows the error for the metamer created without the correlation statistics (at right above), while the second shows the error for the metamer created with all statistics (center), and we can see that larger error in the first plot in the middle row in the first figure, especially the center plot, <code class="docutils literal notranslate"><span class="pre">auto_correlation_reconstructed</span></code>, since these statistics are unconstrained for the synthesis done by <code class="docutils literal notranslate"><span class="pre">met_remove</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_representation</span><span class="p">(</span>
    <span class="n">model</span><span class="p">(</span><span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Without Correlation Statistics&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_representation</span><span class="p">(</span>
    <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Full statistics&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;Full statistics&#39;)
</pre></div>
</div>
<img alt="../../../_images/808fb1f548e845f5612f0a95ccb09527ea0054216c9b80c66e551a301def71ab.png" src="../../../_images/808fb1f548e845f5612f0a95ccb09527ea0054216c9b80c66e551a301def71ab.png" />
<img alt="../../../_images/bdc3ba957093872297170848a1860edafae9b1f47da215b9d0e06e91d02e2416.png" src="../../../_images/bdc3ba957093872297170848a1860edafae9b1f47da215b9d0e06e91d02e2416.png" />
</div>
</div>
</section>
<section id="magnitude-correlation">
<span id="ps-mag-corrs"></span><h2>Magnitude Correlation<a class="headerlink" href="#magnitude-correlation" title="Link to this heading"></a></h2>
<p>In this section, we’ll replicate examples of synthesis failures with the following statistics removed:</p>
<ul class="simple">
<li><p>correlation of the complex magnitude of pairs of coefficients at adjacent positions, orientations and scales.</p></li>
</ul>
<p>These statistics play a role constraining high contrast locations to be organized along lines and edges across all scales. For example, in the image named <code class="docutils literal notranslate"><span class="pre">fig6b.jpg</span></code> the absence of these statistics results in a completely different organization of the orientation content in the edges.</p>
<p>(See figure 6 of <span id="id3"><a class="reference internal" href="../../../citation.html#id27" title="Javier Portilla and Eero P Simoncelli. A parametric texture model based on joint statistics of complex wavelet coefficients. International journal of computer vision, 40(1):49–70, 2000.">Portilla and Simoncelli, 2000</a></span>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># which statistics to remove. note that, in the original paper, magnitude_std is</span>
<span class="c1"># implicitly contained within auto_correlation_magnitude, view the section on</span>
<span class="c1"># differences between plenoptic and matlab implementation for details.</span>
<span class="n">remove_statistics</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;magnitude_std&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cross_orientation_correlation_magnitude&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cross_scale_correlation_magnitude&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auto_correlation_magnitude&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># run on fig6a or fig6b to replicate paper</span>
<span class="n">fig_name</span> <span class="o">=</span> <span class="s2">&quot;fig6b&quot;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">load_images</span><span class="p">(</span><span class="n">IMG_PATH</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># We reuse the model and loss definition from the previous section; the only difference</span>
<span class="c1"># is the image.</span>
<span class="n">met</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-False.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>


<span class="c1"># synthesis with pixel and marginal statistics absent</span>
<span class="n">model_remove</span> <span class="o">=</span> <span class="n">PortillaSimoncelliRemove</span><span class="p">(</span>
    <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">remove_keys</span><span class="o">=</span><span class="n">remove_statistics</span>
<span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
<span class="n">loss_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">portilla_simoncelli_loss_factory</span><span class="p">(</span><span class="n">model_remove</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">met_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model_remove</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_remove</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met_remove</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-True.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="dropdown note admonition">
<p class="admonition-title">How to run these syntheses manually</p>
<!-- TestPortillaSimoncelli.test_ps_remove -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_iter&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;max_eval&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;line_search_fn&quot;</span><span class="p">:</span> <span class="s2">&quot;strong_wolfe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">met</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">,</span> <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="n">opt_kwargs</span><span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Call the <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.setup" title="plenoptic.synthesize.metamer.Metamer.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">setup</span></code></a> and <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.synthesize" title="plenoptic.synthesize.metamer.Metamer.synthesize"><code class="xref py py-func docutils literal notranslate"><span class="pre">synthesize</span></code></a> methods of <code class="docutils literal notranslate"><span class="pre">met_remove</span></code> with the same arguments.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize results</span>
<span class="n">po</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="p">[</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">,</span> <span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Target image&quot;</span><span class="p">,</span> <span class="s2">&quot;Full Statistics&quot;</span><span class="p">,</span> <span class="s2">&quot;Without Magnitude Statistics&quot;</span><span class="p">],</span>
    <span class="n">vrange</span><span class="o">=</span><span class="s2">&quot;auto1&quot;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/6bf0af39e669a0412b280cbd3c72a0311831c3fa64f5fd5635956483294dd2ea.png" src="../../../_images/6bf0af39e669a0412b280cbd3c72a0311831c3fa64f5fd5635956483294dd2ea.png" />
</div>
</div>
<p>And again, let’s look at the error plots. The first figure shows the error for the metamer created without the correlation statistics (at right above), while the second shows the error for the metamer created with all statistics (center), and we can see that larger error in the plot scorresponding to <code class="docutils literal notranslate"><span class="pre">auto_correlation_magnitude</span></code>, <code class="docutils literal notranslate"><span class="pre">cross_orientation_correlation_magnitude</span></code>, and <code class="docutils literal notranslate"><span class="pre">cross_scale_correlation_magnitude</span></code>., since these statistics are unconstrained for the synthesis done by <code class="docutils literal notranslate"><span class="pre">met_remove</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_representation</span><span class="p">(</span>
    <span class="n">model</span><span class="p">(</span><span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Without Correlation Statistics&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_representation</span><span class="p">(</span>
    <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Full statistics&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/0324080099eea7edd5936372fdd1629de298044224528e018a6eff8602fb04f3.png" src="../../../_images/0324080099eea7edd5936372fdd1629de298044224528e018a6eff8602fb04f3.png" />
<img alt="../../../_images/7ad06f8a5cf035ba0d3ab991dce0098ebe1639f56fbb49a5c64f332549642268.png" src="../../../_images/7ad06f8a5cf035ba0d3ab991dce0098ebe1639f56fbb49a5c64f332549642268.png" />
</div>
</div>
</section>
<section id="cross-scale-phase-statistics">
<span id="ps-cross-scale"></span><h2>Cross-scale Phase Statistics<a class="headerlink" href="#cross-scale-phase-statistics" title="Link to this heading"></a></h2>
<p>In this section, we’ll replicate examples of synthesis failures with the following statistics removed:</p>
<ul class="simple">
<li><p>relative phase of coefficients of bands at adjacent scales</p></li>
</ul>
<p>These statistics play a role constraining high contrast locations to be organized along lines and edges across all scales. These phase statistics are important in representing textures with strong illumination effects. When they are removed, the synthesized images appear much less three dimensional and lose the detailed structure of shadows.</p>
<p>(See figure 8 of <span id="id4"><a class="reference internal" href="../../../citation.html#id27" title="Javier Portilla and Eero P Simoncelli. A parametric texture model based on joint statistics of complex wavelet coefficients. International journal of computer vision, 40(1):49–70, 2000.">Portilla and Simoncelli, 2000</a></span>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># which statistics to remove</span>
<span class="n">remove_statistics</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cross_scale_correlation_real&quot;</span><span class="p">]</span>

<span class="c1"># run on fig8a and fig8b to replicate paper</span>
<span class="n">fig_name</span> <span class="o">=</span> <span class="s2">&quot;fig8b&quot;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">load_images</span><span class="p">(</span><span class="n">IMG_PATH</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># We reuse the model and loss definition from the first section; the only difference</span>
<span class="c1"># is the image.</span>
<span class="n">met</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-False.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>

<span class="c1"># synthesis with pixel and marginal statistics absent</span>
<span class="n">model_remove</span> <span class="o">=</span> <span class="n">PortillaSimoncelliRemove</span><span class="p">(</span>
    <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">remove_keys</span><span class="o">=</span><span class="n">remove_statistics</span>
<span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
<span class="n">loss_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">portilla_simoncelli_loss_factory</span><span class="p">(</span><span class="n">model_remove</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">met_remove</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">model_remove</span><span class="p">,</span>
    <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_remove</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">met_remove</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">CACHE_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ps_remove_</span><span class="si">{</span><span class="n">fig_name</span><span class="si">}</span><span class="s2">_remove-True.pt&quot;</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="dropdown note admonition">
<p class="admonition-title">How to run these syntheses manually</p>
<!-- TestPortillaSimoncelli.test_ps_remove -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_iter&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;max_eval&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;line_search_fn&quot;</span><span class="p">:</span> <span class="s2">&quot;strong_wolfe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">met</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">,</span> <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="n">opt_kwargs</span><span class="p">)</span>
<span class="n">met</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Call the <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.setup" title="plenoptic.synthesize.metamer.Metamer.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">setup</span></code></a> and <a class="reference internal" href="../../../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer.synthesize" title="plenoptic.synthesize.metamer.Metamer.synthesize"><code class="xref py py-func docutils literal notranslate"><span class="pre">synthesize</span></code></a> methods of <code class="docutils literal notranslate"><span class="pre">met_remove</span></code> with the same arguments.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize results</span>
<span class="n">po</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="p">[</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">,</span> <span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Target image&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Full Statistics&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Without Cross-Scale Phase Statistics&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">vrange</span><span class="o">=</span><span class="s2">&quot;auto1&quot;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e021739c2956da4bf5dac0611d18f89c3f027a689a02b082d630cc6645de21d7.png" src="../../../_images/e021739c2956da4bf5dac0611d18f89c3f027a689a02b082d630cc6645de21d7.png" />
</div>
</div>
<p>And again, let’s look at the error plots. The first figure shows the error for the metamer created without the correlation statistics (at right above), while the second shows the error for the metamer created with all statistics (center), and we can see that larger error in the final plot in the first figure, <code class="docutils literal notranslate"><span class="pre">cross_scale_correlation_real</span></code>, since these statistics are unconstrained for the synthesis done by <code class="docutils literal notranslate"><span class="pre">metamer_remove</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_representation</span><span class="p">(</span>
    <span class="n">model</span><span class="p">(</span><span class="n">met_remove</span><span class="o">.</span><span class="n">metamer</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Without Correlation Statistics&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_representation</span><span class="p">(</span>
    <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">metamer</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Full statistics&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;Full statistics&#39;)
</pre></div>
</div>
<img alt="../../../_images/b1b0c92c1b25f525b5c0f73749b680adabc15b0c87ae910c7307954264cc01a0.png" src="../../../_images/b1b0c92c1b25f525b5c0f73749b680adabc15b0c87ae910c7307954264cc01a0.png" />
<img alt="../../../_images/b84890885043dcfcb9250e36d3e0cf2c26fbe6e2b71a43f65bf62f81bbfe82cc.png" src="../../../_images/b84890885043dcfcb9250e36d3e0cf2c26fbe6e2b71a43f65bf62f81bbfe82cc.png" />
</div>
</div>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>To see more texture model metamers with different types of images, see the <a class="reference internal" href="ps_examples.html"><span class="doc std std-doc">Example Portilla-Simoncelli metamers from different texture classes</span></a> notebook.</p></li>
<li><p>To learn more about the optimization choices, read the <a class="reference internal" href="ps_optimization.html#ps-optimization"><span class="std std-ref">Portilla-Simoncelli optimization details</span></a> notebook.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ps_examples.html" class="btn btn-neutral float-left" title="Example Portilla-Simoncelli metamers from different texture classes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ps_optimization.html" class="btn btn-neutral float-right" title="Portilla-Simoncelli optimization details" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2025, Plenoptic authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>