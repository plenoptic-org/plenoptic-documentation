
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contributing &#8212; plenoptic 1.3.2.dev302 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d54d67fd" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=06b62906"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=6dbb43f8"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developers/contributing';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.plenoptic.org/docs/branch/main/_static/version_switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.3.2';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <script src="../_static/custom-icon.js?v=0bae05a2"></script>
    <link rel="icon" href="../_static/plenoptic.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Synthesis object design" href="synthesis.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.3.2" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Plenoptic_Logo_CMYK_Full_Wide.svg" class="logo__image only-light" alt="plenoptic 1.3.2.dev302 documentation - Home"/>
    <img src="../_static/Plenoptic_Logo_CMYK_Full_DarkMode_Wide.svg" class="logo__image only-dark pst-js-only" alt="plenoptic 1.3.2.dev302 documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/plenoptic-org/plenoptic/releases">
    Changelog
  </a>
</li>


<li class=" current active">
  <a class="nav-link dropdown-item nav-internal" href="index.html">
    For developers
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://plenoptic.org" title="Home" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-house fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Home</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/plenoptic-org/plenoptic" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/plenoptic" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/plenoptic-org/plenoptic/releases">
    Changelog
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    For developers
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://plenoptic.org" title="Home" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-house fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Home</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/plenoptic-org/plenoptic" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/plenoptic" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="synthesis.html">Synthesis object design</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Contributing</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">For developers</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Contributing</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> is a python library of tools to help researchers better understand
their models. We welcome and encourage contributions from everyone!</p>
<p>First, please check out the <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a> and read it
before going any further. You may also want to check out the <a class="reference internal" href="../index.html#index-doc"><span class="std std-ref">main page of the
documentation</span></a> for a longer
overview of the project and how to get everything installed, as well as pointers
for further reading, depending on your interests.</p>
<p>If you encounter any issues with <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>, first search the existing
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues">issues</a> and
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/discussions">discussions</a>
to see if there’s already information to help you. If not, please open a new
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues">issue</a>! We have
a template for bug reports, and following it (so you provide the necessary
details) will make solving your problem much easier.</p>
<p>If you’d like to help improve <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>, there are many ways you can
contribute, from improving documentation to writing code. For those not already
familiar with the project, it can be very helpful for us if you go through the
tutorials, README, and documentation and let us know if anything is unclear,
what needs more detail (or clearer writing), etc. For those that want to
contribute code, we also have many
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues">issues</a> that we
are working through. If you would like to work on one of those, please give it a
try!</p>
<p>In order to submit changes, create a branch or fork of the project, make your
changes, add documentation and tests, and submit a <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/pulls">Pull
Request</a>. See
<a class="reference internal" href="#contributing-to-the-code"><span class="std std-ref">contributing to the code below</span></a> for more details on
this process.</p>
<p>We try to keep all our communication on Github, and we use several channels:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/plenoptic-org/plenoptic/discussions">Discussions</a>
is the place to ask usage questions, discuss issues too broad for a
single issue, or show off what you’ve made with plenoptic.</p></li>
<li><p>If you’ve come across a bug, open an
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues">issue</a>.</p></li>
<li><p>If you have an idea for an extension or enhancement, please post in the
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/discussions/categories/ideas">ideas
section</a>
of discussions first. We’ll discuss it there and, if we decide to pursue it,
open an issue to track progress.</p></li>
</ul>
<section id="supported-versions">
<h2>Supported versions<a class="headerlink" href="#supported-versions" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> tries to follow
<a class="reference external" href="https://scientific-python.org/specs/spec-0000/">SPEC-0</a>: we support python
versions are supported for 3 years following initial release. This means that we
support three python feature versions (e.g., 3.10, 3.11, and 3.12) at any one
time and that we’ll transition between versions during the fourth quarter of
each year. We run our CPU tests on all three versions, and the GPU tests and
documentation build use the middle version.</p>
</section>
<section id="contributing-to-the-code">
<span id="id1"></span><h2>Contributing to the code<a class="headerlink" href="#contributing-to-the-code" title="Link to this heading">#</a></h2>
<section id="contribution-workflow">
<h3>Contribution workflow<a class="headerlink" href="#contribution-workflow" title="Link to this heading">#</a></h3>
<p>We welcome contributions to <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>! In order to contribute, please create
your own branch, make sure the tests pass, and open a Pull Request. We follow
the <a class="reference external" href="https://www.gitkraken.com/learn/git/best-practices/git-branch-strategy#github-flow-branch-strategy">GitHub
Flow</a>
workflow: no one is allowed to push to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch, all development
happens in separate feature branches (each of which, ideally, implements a
single feature, addresses a single issue, or fixes a single problem), and these
get merged into <code class="docutils literal notranslate"><span class="pre">main</span></code> once we have determined they’re ready. Then, after enough
changes have accumulated, we put out a new release, adding a new tag which
increments the version number, and uploading the new release to PyPI (see
<a class="reference internal" href="#releases"><span class="std std-ref">releases</span></a> for more details).</p>
<p>In addition to the information that follows, <a class="reference external" href="https://docs.github.com/en/get-started/quickstart/github-flow">Github</a> (unsurprisingly) has good information on this workflow, as does the <a class="reference external" href="https://github.com/flatironinstitute/CaImAn/blob/main/CONTRIBUTING.md">Caiman package</a> (though note that the Caiman uses <strong>git</strong> flow, which involves a separate develop branch in addition to main).</p>
<p>Before we begin: everyone finds <code class="docutils literal notranslate"><span class="pre">git</span></code> confusing the first few (dozen) times they encounter it! And even people with a hard-won understanding frequently look up information on how it works. If you find the following difficult, we’re happy to help walk you through the process. Please <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/discussions">post on our GitHub discussions page</a> to get help.</p>
<section id="creating-a-development-environment">
<h4>Creating a development environment<a class="headerlink" href="#creating-a-development-environment" title="Link to this heading">#</a></h4>
<p>You’ll need a local installation of <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> which keeps up-to-date with any changes you make. To do so, you will need to fork and clone <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>:</p>
<ol class="arabic simple">
<li><p>Go to the <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/">plenoptic repo</a> and click on the <code class="docutils literal notranslate"><span class="pre">Fork</span></code> button at the top right of the page. This creates a copy of plenoptic in your Github account.</p></li>
<li><p>You should then clone <em>your fork</em> to your local machine and create an editable installation. To do so, follow the instructions for an editable install found in our <a class="reference internal" href="../getting_started/install.html#source"><span class="std std-ref">docs</span></a>, replacing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/plenoptic-org/plenoptic.git</span></code> with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/&lt;YourUserName&gt;/plenoptic.git</span></code>.</p></li>
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">upstream</span></code> branch: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">add</span> <span class="pre">upstream</span> <span class="pre">https://github.com/plenoptic-org/plenoptic.git</span></code>. At this point, you have two remotes: <code class="docutils literal notranslate"><span class="pre">origin</span></code> (your fork) and <code class="docutils literal notranslate"><span class="pre">upstream</span></code> (the canonical version). You won’t have permission to push to upstream (only <code class="docutils literal notranslate"><span class="pre">origin</span></code>), but this makes it easy to keep your <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> up to date with the canonical version by pulling from upstream: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span> <span class="pre">upstream</span></code>.</p></li>
</ol>
<p>You should probably also install all the optional dependencies, so that you can run tests, build the documentation, and run the jupyter notebooks locally. To do so, run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">&quot;.[docs,dev,nb]&quot;</span></code> from within the copy of <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> on your machine (see <a class="reference internal" href="../getting_started/jupyter.html#jupyter-doc"><span class="std std-ref">docs</span></a> of our documentation for information on how to set up jupyter if you don’t want an extra copy of it in this environment).</p>
</section>
<section id="creating-a-new-branch">
<h4>Creating a new branch<a class="headerlink" href="#creating-a-new-branch" title="Link to this heading">#</a></h4>
<p>As discussed above, each feature in <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> is worked on in a separate branch. This allows us to have multiple people developing multiple features simultaneously, without interfering with each other’s work. To create your own branch, run the following from within your <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># switch to main branch of your fork</span>
git<span class="w"> </span>checkout<span class="w"> </span>main
<span class="c1"># update your fork from your github</span>
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
<span class="c1"># ensure your fork is in sync with the canonical version</span>
git<span class="w"> </span>pull<span class="w"> </span>upstream<span class="w"> </span>main
<span class="c1"># update your fork&#39;s main branch with any changes from upstream</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main
<span class="c1"># create and switch to the branch</span>
git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>my_cool_branch
</pre></div>
</div>
<p>Then, create new changes on this branch and, when you’re ready, add and commit them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># stage the changes</span>
git<span class="w"> </span>add<span class="w"> </span>src/plenoptic/the_file_you_changed.py
<span class="c1"># commit your changes</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;A helpful message explaining my changes&quot;</span>
<span class="c1"># push to the origin remote</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>my_cool_branch
</pre></div>
</div>
<p>If you aren’t comfortable with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code>, I recommend the <a class="reference external" href="https://swcarpentry.github.io/git-novice/">Software Carpentry git lesson</a>.</p>
</section>
<section id="contributing-your-change-back-to-plenoptic">
<h4>Contributing your change back to plenoptic<a class="headerlink" href="#contributing-your-change-back-to-plenoptic" title="Link to this heading">#</a></h4>
<p>You can make any number of changes on your branch. Once you’re happy with your changes, <a class="reference internal" href="#adding-tests"><span class="std std-ref">add tests</span></a> to check that they run correctly and <a class="reference internal" href="#adding-documentation"><span class="std std-ref">add documentation</span></a>, then make sure the existing <a class="reference internal" href="#testing"><span class="std std-ref">tests</span></a> all run successfully, that your branch is up-to-date with main, and then open a pull request by clicking on the big <code class="docutils literal notranslate"><span class="pre">Compare</span> <span class="pre">&amp;</span> <span class="pre">pull</span> <span class="pre">request</span></code> button that appears at the top of your fork after pushing to your branch (see <a class="reference external" href="https://intersect-training.org/collaborative-git/pr.html">here</a> for a tutorial).</p>
<p>Your pull request should include information on what you changed and why, referencing any relevant issues or discussions, and highlighting any portion of your changes where you have lingering questions (e.g., “was this the right way to implement this?”) or want reviewers to pay special attention. You can look at previous closed pull requests to see what this looks like.</p>
<p>At this point, we will be notified of the pull request and will read it over. We will try to give an initial response quickly, and then do a longer in-depth review, at which point you will probably need to respond to our comments, making changes as appropriate. We’ll then respond again, and proceed in an iterative fashion until everyone is happy with the proposed changes. This process can take a while! (The more focused your pull request, the less time it will take.)</p>
<p>If your changes are integrated, you will be added as a Github contributor and as one of the authors of the package. Thank you for being part of <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>!</p>
</section>
</section>
<section id="code-style-and-linting">
<h3>Code Style and Linting<a class="headerlink" href="#code-style-and-linting" title="Link to this heading">#</a></h3>
<p>We use <a class="reference external" href="https://docs.astral.sh/ruff/">Ruff</a> for linting and formatting our Python code to maintain a consistent code style and catch potential errors early. We run ruff as part of our CI (using pre-commit, see below) and non-compliant code will not be merged! You can see the version of <code class="docutils literal notranslate"><span class="pre">ruff</span></code> that we are currently using in the <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> file in the project root .</p>
<section id="using-ruff">
<h4>Using Ruff<a class="headerlink" href="#using-ruff" title="Link to this heading">#</a></h4>
<p>Ruff is a fast and comprehensive Python formatter and linter that checks for common style and code quality issues. It combines multiple tools, like black, Pyflakes, pycodestyle, isort, and other linting rules into one efficient tool, which are specified in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. Before submitting your code, make sure to run Ruff to catch any issues. See other sections of this document for how to use <code class="docutils literal notranslate"><span class="pre">nox</span></code> and <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> to simplify this process.</p>
<p>Ruff has two components, a <a class="reference external" href="https://docs.astral.sh/ruff/formatter/">formatter</a> and a <a class="reference external" href="https://docs.astral.sh/ruff/linter/">linter</a>. Formatters and linters are both static analysis tools, but formatters “quickly check and reformat your code for stylistic consistency without changing the runtime behavior of the code”, while linters “detect not just stylistic inconsistency but also potential logical bugs, and often suggest code fixes” (per <a class="reference external" href="https://github.com/readme/guides/formatters-linters-compilers">GitHub’s readme project</a>). There are many choices of formatters and linters in python; ruff aims to combine the features of many of them while being very fast.</p>
<p>For both the formatter and the linter, you can run ruff without any additional arguments; our configuration option are stored in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file and so don’t need to be specified explicitly.</p>
<section id="formatting">
<h5>Formatting:<a class="headerlink" href="#formatting" title="Link to this heading">#</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">ruff</span> <span class="pre">format</span></code> is the primary entrypoint to the formatter. It accepts a list of files or directories, and formats all discovered Python files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ruff<span class="w"> </span>format<span class="w">                   </span><span class="c1"># Format all files in the current directory.</span>
ruff<span class="w"> </span>format<span class="w"> </span>path/to/code/<span class="w">     </span><span class="c1"># Format all files in `path/to/code` (and any subdirectories).</span>
ruff<span class="w"> </span>format<span class="w"> </span>path/to/file.py<span class="w">   </span><span class="c1"># Format a single file.</span>
</pre></div>
</div>
<p>For the full list of supported options, run <code class="docutils literal notranslate"><span class="pre">ruff</span> <span class="pre">format</span> <span class="pre">--help</span></code>.</p>
</section>
<section id="using-ruff-for-linting">
<h5>Using Ruff for Linting:<a class="headerlink" href="#using-ruff-for-linting" title="Link to this heading">#</a></h5>
<p>To run Ruff on your code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ruff<span class="w"> </span>check<span class="w"> </span>.
</pre></div>
</div>
<p>It’ll then tell you which lines are violating linting rules and may suggest that some errors are automatically fixable.</p>
<p>To automatically fix lintint errors, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ruff<span class="w"> </span>--fix<span class="w"> </span>.
</pre></div>
</div>
<p>Be careful with <strong>unsafe fixes</strong>, safe fixes are symbolized with the tools emoji and are listed <a class="reference external" href="https://docs.astral.sh/ruff/rules/">here</a>!</p>
</section>
</section>
<section id="ignoring-ruff-linting">
<h4>Ignoring Ruff Linting<a class="headerlink" href="#ignoring-ruff-linting" title="Link to this heading">#</a></h4>
<p>In some cases, it may be acceptable to suppress lint errors, for example when too long lines (code <code class="docutils literal notranslate"><span class="pre">E501</span></code>) are desired because otherwise the url might not be readable anymore. These ignores will be evaluated on a case-by-case basis.
You can do this by adding the following to the end of the line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>This<span class="w"> </span>line<span class="w"> </span>is<span class="w"> </span>tooooooo<span class="w"> </span>long.<span class="w"> </span><span class="c1"># noqa: E501</span>
</pre></div>
</div>
<p>If you want to suppress an error across an entire file, do this at the top of the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ruff: noqa: E501</span>
Below<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>python<span class="w"> </span>script
...
...
And<span class="w"> </span>any<span class="w"> </span>line<span class="w"> </span>living<span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span>file<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>as<span class="w"> </span>long<span class="w"> </span>as<span class="w"> </span>it<span class="w"> </span>wants<span class="w">  </span>...
...
</pre></div>
</div>
<p>In some cases, you want to not only suppress the error message a linter throws but actually <em>disable</em> a linting rule. An example might be if the import order matters and running <code class="docutils literal notranslate"><span class="pre">isort</span></code> would mess with this.
In these cases, you can introduce an <a class="reference external" href="https://docs.astral.sh/ruff/linter/#action-comments">action comment</a> like this such that ruff does <em>not</em> sort the following packages alphabetically:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import<span class="w"> </span>numpy<span class="w"> </span>as<span class="w"> </span>np<span class="w"> </span><span class="c1"># isort: skip</span>
import<span class="w"> </span>my_package<span class="w"> </span>as<span class="w"> </span>mp<span class="w"> </span><span class="c1"># isort: skip</span>
</pre></div>
</div>
<p>For more details, refer to the <a class="reference external" href="https://docs.astral.sh/ruff/linter/#error-suppression">documentation</a>.</p>
</section>
<section id="general-style-guide-recommendations">
<h4>General Style Guide Recommendations:<a class="headerlink" href="#general-style-guide-recommendations" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Longer, descriptive names are preferred (e.g., <code class="docutils literal notranslate"><span class="pre">x</span></code> is not an appropriate name
for a variable), especially for anything user-facing, such as methods,
attributes, or arguments.</p></li>
<li><p>Any public method or function must have a complete type-annotated docstring
(see <a class="reference internal" href="#docstrings"><span class="std std-ref">below</span></a> for details). Hidden ones do not <em>need</em> to have
complete docstrings, but they probably should.</p></li>
</ul>
</section>
<section id="pre-commit-hooks-identifying-simple-issues-before-submission-to-code-review-and-how-to-ignore-those">
<h4>Pre-Commit Hooks:  Identifying simple issues before submission to code review (and how to ignore those)<a class="headerlink" href="#pre-commit-hooks-identifying-simple-issues-before-submission-to-code-review-and-how-to-ignore-those" title="Link to this heading">#</a></h4>
<p><a class="reference external" href="https://pre-commit.com/">Pre-commit</a> hooks are useful for the developer to check if all the linting and formatting rules (see Ruff above) are honored <em>before</em> committing. That is, when you commit, pre-commit hooks are run and auto-fixed where possible (e.g., trailing whitespace). You then need to add <em>again</em> if you want these changes to be included in your commit. If the problem is not automatically fixable, you will need to manually update your code before you are able to commit.</p>
<p>Using pre-commit is optional. We use <a class="reference external" href="https://pre-commit.ci/">pre-commit.ci</a> to run pre-commit as part of PRs (auto-fixing wherever possible), but it may simplify your life to integrate pre-commit into your workflow.</p>
<p>In order to use pre-commit, you must install the <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> package into your development environment, and then install the hooks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pre-commit
pre-commit<span class="w"> </span>install
</pre></div>
</div>
<p>See <a class="reference external" href="https://pre-commit.com/">pre-commit docs</a> for more details.</p>
<p>After installation, should you want to ignore pre-commit hooks for some reason (e.g., because you have to run to a meeting and so don’t have time to fix all the linting errors but still want your changes to be committed), you can add <code class="docutils literal notranslate"><span class="pre">--no-verify</span></code> to your commit message like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span>&lt;my<span class="w"> </span>commit<span class="w"> </span>message&gt;<span class="w"> </span>--no-verify
</pre></div>
</div>
</section>
</section>
<section id="adding-models-or-synthesis-methods">
<h3>Adding models or synthesis methods<a class="headerlink" href="#adding-models-or-synthesis-methods" title="Link to this heading">#</a></h3>
<p>In addition to the above, see the documentation for a description of
<a class="reference internal" href="../reference/models.html#models-doc"><span class="std std-ref">models</span></a> and <a class="reference internal" href="synthesis.html#synthesis-objects"><span class="std std-ref">synthesis
objects</span></a>. Any new
models or synthesis objects will need to meet the requirements outlined in those
pages.</p>
</section>
<section id="releases">
<span id="id2"></span><h3>Releases<a class="headerlink" href="#releases" title="Link to this heading">#</a></h3>
<p>We create releases on Github, deploy on / distribute via
<a class="reference external" href="https://pypi.org/">pypi</a>, and try to follow <a class="reference external" href="https://semver.org/">semantic
versioning</a>:</p>
<blockquote>
<div><p>Given a version number MAJOR.MINOR.PATCH, increment the:</p>
<ol class="arabic simple">
<li><p>MAJOR version when you make incompatible API changes</p></li>
<li><p>MINOR version when you add functionality in a backward compatible manner</p></li>
<li><p>PATCH version when you make backward compatible bug fixes</p></li>
</ol>
</div></blockquote>
<p>When doing a new release, the following steps must be taken:</p>
<ol class="arabic simple">
<li><p>In a new PR:</p></li>
</ol>
<ul class="simple">
<li><p>Update all the <a class="reference external" href="https://mybinder.org">binder</a> links, which are of the form
<code class="docutils literal notranslate"><span class="pre">https://mybinder.org/v2/gh/plenoptic-org/plenoptic/X.Y.Z?filepath=examples</span></code>,
which are found in <code class="docutils literal notranslate"><span class="pre">README.md</span></code> and <code class="docutils literal notranslate"><span class="pre">index.md</span></code>. Note that the version tag
must match the github tag (specified in the next step) or the link won’t
work.</p></li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">docs/_static/version_switcher.json</span></code>. You will need to add a section
for the new release and move the <code class="docutils literal notranslate"><span class="pre">preferred=true</span></code> line to that section.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>After merging the above PR into the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch, <a class="reference external" href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository">create a Github
release</a>
with a new tag matching that used in the binder link above: <code class="docutils literal notranslate"><span class="pre">X.Y.Z</span></code>. Creating
the release will trigger the deployment to pypi, via our <code class="docutils literal notranslate"><span class="pre">deploy</span></code> action
(found in <code class="docutils literal notranslate"><span class="pre">.github/workflows/deploy.yml</span></code>). The built version will grab the
version tag from the Github release, using
<a class="reference external" href="https://github.com/pypa/setuptools_scm">setuptools_scm</a>.</p></li>
</ol>
<p>Note that the binder link I have been unable to find a way to make binder use the latest github release tag directly (or make <a class="reference external" href="https://mybinder.org">binder</a> use a <code class="docutils literal notranslate"><span class="pre">latest</span></code> tag, so ensure they match!</p>
<p>Shortly after the deploy to pypi goes through (typically within a day), a PR will be automatically opened on the <a class="reference external" href="https://github.com/conda-forge/plenoptic-feedstock">conda-forge/plenoptic-feedstock</a> repo. After merging that PR, the <a class="reference external" href="https://anaconda.org/conda-forge/plenoptic">plenoptic version on conda-forge</a> will also be updated</p>
</section>
</section>
<section id="testing">
<span id="id3"></span><h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>Before running tests locally, you’ll need
<a class="reference external" href="https://ffmpeg.org/download.html">ffmpeg</a> installed on your system, as well as
the <code class="docutils literal notranslate"><span class="pre">dev</span></code> optional dependencies (i.e., you should run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">&quot;.[dev]&quot;</span></code>
from within your local copy of <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>).</p>
<p>To run all tests, run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> from the main <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> directory. This
will take a while, as we have many tests, broken into categories. There are
several choices for how to run a subset of the tests:</p>
<ul class="simple">
<li><p>Run tests from one file: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/test_mod.py</span></code></p></li>
<li><p>Run tests by keyword expressions: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-k</span> <span class="pre">&quot;MyClass</span> <span class="pre">and</span> <span class="pre">not</span> <span class="pre">method&quot;</span></code>. This
will run tests which contain names that match the given string expression,
which can include Python operators that use filenames, class names and
function names as variables. The example above will run
<code class="docutils literal notranslate"><span class="pre">TestMyClass.test_something</span></code> but not <code class="docutils literal notranslate"><span class="pre">TestMyClass.test_method_simple</span></code>.</p></li>
<li><p>To run a specific test within a module: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/test_mod.py::test_func</span></code></p></li>
<li><p>Another example specifying a test method in the command line: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">test_mod.py::TestClass::test_method</span></code></p></li>
</ul>
<p>View the <a class="reference external" href="https://doc.pytest.org/en/latest/usage.html">pytest documentation</a> for
more info.</p>
<section id="running-pytest-with-non-standard-cache-directories">
<h3>Running pytest with non-standard cache directories<a class="headerlink" href="#running-pytest-with-non-standard-cache-directories" title="Link to this heading">#</a></h3>
<p>When running tests on some machines (e.g., nodes of the Flatiron cluster), the default cache directories used by some of the libraries will not exist, so running the tests like normal will result in errors that complain about directories not existing or not having permission to create directories in e.g., <code class="docutils literal notranslate"><span class="pre">/home/wbroderick</span></code>.</p>
<p>To avoid this problem, we can use environment variables to control the behavior of these libraries. To do so for pooch (downloading test files), torch (downloading pretrained models), and matplotlib (caching config files), prepend the following to your pytest command: <code class="docutils literal notranslate"><span class="pre">PYTORCH_KERNEL_CACHE_PATH=~/.cache/torch/kernels</span> <span class="pre">TORCH_HOME=~/.cache/torch</span> <span class="pre">MPLCONFIGDIR=~/.cache/matplotlib</span> <span class="pre">PLENOPTIC_CACHE_DIR=~/.cache/plenoptic</span></code> (or replace <code class="docutils literal notranslate"><span class="pre">~/.cache/</span></code> with some other directory).</p>
<blockquote>
<div><p>[!NOTE]
This may also be helpful when building the documentation.</p>
</div></blockquote>
<p>See relevant torch <a class="reference external" href="https://docs.pytorch.org/docs/stable/notes/cuda.html#just-in-time-compilation">1</a> and <a class="reference external" href="https://docs.pytorch.org/docs/stable/hub.html#where-are-my-downloaded-models-saved">2</a>, <a class="reference external" href="https://www.fatiando.org/pooch/latest/user-defined-cache.html">pooch</a>, and <a class="reference external" href="https://matplotlib.org/stable/install/environment_variables_faq.html#envvar-MPLCONFIGDIR">matplotlib</a> docs.</p>
</section>
<section id="using-nox-to-simplify-testing-and-linting">
<h3>Using nox to simplify testing and linting<a class="headerlink" href="#using-nox-to-simplify-testing-and-linting" title="Link to this heading">#</a></h3>
<p>This section is optional but if you want to easily run tests in an isolated environment
using the <a class="reference external" href="https://nox.thea.codes/en/stable/">nox</a> command-line tool.</p>
<p>Before proceeding, you’ll need to install <code class="docutils literal notranslate"><span class="pre">nox</span></code>. You can do this in your plenoptic environment, but it is more common to install it system-wide using <code class="docutils literal notranslate"><span class="pre">pipx</span></code>: <code class="docutils literal notranslate"><span class="pre">pipx</span> <span class="pre">install</span> <span class="pre">nox</span></code>. This installs <code class="docutils literal notranslate"><span class="pre">nox</span></code> into a globally-available isolated environment, see <a class="reference external" href="https://pipx.pypa.io/stable/">pipx docs</a> for more details.</p>
<p>You will also need to install <code class="docutils literal notranslate"><span class="pre">pyyaml</span></code> in the same environment as <code class="docutils literal notranslate"><span class="pre">nox</span></code>. If you used <code class="docutils literal notranslate"><span class="pre">pipx</span></code>, then run <code class="docutils literal notranslate"><span class="pre">pipx</span> <span class="pre">inject</span> <span class="pre">nox</span> <span class="pre">pyyaml</span></code>.</p>
<p>To run all tests, formatters, and linters through <code class="docutils literal notranslate"><span class="pre">nox</span></code>, from the root folder of the
plenoptic package, execute the following command,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nox
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nox</span></code> will read the configuration from the <code class="docutils literal notranslate"><span class="pre">noxfile.py</span></code> script.</p>
<p>If you only want to run an individual session (e.g., lint or test), you can first check which sessions are available with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nox<span class="w"> </span>-l
</pre></div>
</div>
<p>Then you can use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nox<span class="w"> </span>-s<span class="w"> </span>&lt;your_nox_session&gt;
</pre></div>
</div>
<p>to run the session of your choice.</p>
<p>Here are some examples:</p>
<p>If you want to run just the tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nox<span class="w"> </span>-s<span class="w"> </span>tests
</pre></div>
</div>
<p>for running only the linters,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nox<span class="w"> </span>-s<span class="w"> </span>lint
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nox</span></code> offers a variety of configuration options, you can learn more about it from their
<a class="reference external" href="https://nox.thea.codes/en/stable/config.html">documentation</a>.</p>
<p>Note that nox works particularly well with pyenv, discussed later in this file, which makes it easy to install the multiple python versions used in testing.</p>
<section id="multi-python-version-testing-with-pyenv">
<h4>Multi-python version testing with pyenv<a class="headerlink" href="#multi-python-version-testing-with-pyenv" title="Link to this heading">#</a></h4>
<p>Sometimes, before opening a pull-request that will trigger the <code class="docutils literal notranslate"><span class="pre">.github/workflow/ci.yml</span></code> continuous
integration workflow, you may want to test your changes over all the supported python versions locally.</p>
<p>Handling multiple installed python versions on the same machine can be challenging and confusing.
<a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a> is a great tool that really comes to the rescue. Note that pyenv just handles python versions — virtual environments have to be handled separately, using <a class="reference external" href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a>!</p>
<p>This tool doesn’t come with the package dependencies and has to be installed separately. Installation instructions
are system specific but the package readme is very details, see
<a class="reference external" href="https://github.com/pyenv/pyenv?tab=readme-ov-file#installation">here</a>.</p>
<p>Follow carefully the instructions to configure pyenv after installation.</p>
<p>Once you have the package installed and configured, you can install multiple python version through it.
First get a list of the available versions with the command,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>install<span class="w"> </span>-l
</pre></div>
</div>
<p>Install the python version you need. For this example, let’s assume we want <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.10.11</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.11.8</span></code>,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>install<span class="w"> </span><span class="m">3</span>.10.11
pyenv<span class="w"> </span>install<span class="w"> </span><span class="m">3</span>.11.8
</pre></div>
</div>
<p>You can check which python version is currently set as default, by typing,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>which<span class="w"> </span>python
</pre></div>
</div>
<p>And you can list all available versions of python with,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>versions
</pre></div>
</div>
<p>If you want to run <code class="docutils literal notranslate"><span class="pre">nox</span></code> on multiple python versions, all you need to do is:</p>
<ol class="arabic">
<li><p>Set your desired versions as <code class="docutils literal notranslate"><span class="pre">global</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>global<span class="w"> </span><span class="m">3</span>.11.8<span class="w"> </span><span class="m">3</span>.10.11
</pre></div>
</div>
<p>This will make both version available, and the default python will be set to the first one listed
(<code class="docutils literal notranslate"><span class="pre">3.11.8</span></code> in this case).</p>
</li>
<li><p>Run nox specifying the python version as an option.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nox<span class="w"> </span>-p<span class="w"> </span><span class="m">3</span>.10
</pre></div>
</div>
</li>
</ol>
<p>Note that <code class="docutils literal notranslate"><span class="pre">noxfile.py</span></code> lists the available option as keyword arguments in a session specific manner.</p>
<p>As mentioned earlier, if you have multiple python version installed, we recommend you manage your virtual environments through pyenv using the <a class="reference external" href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a> extension.</p>
<p>This tool works with most of the environment managers including (<code class="docutils literal notranslate"><span class="pre">venv</span></code> and <code class="docutils literal notranslate"><span class="pre">conda</span></code>).
Creating an environment with it is as simple as calling,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>virtualenv<span class="w"> </span>my-python<span class="w"> </span>my-enviroment
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">my-python</span></code> is the python version, chosen from those listed by <code class="docutils literal notranslate"><span class="pre">pyenv</span> <span class="pre">versions</span></code>, and <code class="docutils literal notranslate"><span class="pre">my-environment</span></code> is your new environment name.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">my-python</span></code> has <code class="docutils literal notranslate"><span class="pre">conda</span></code> installed, it will create a conda environment, if not, it will use <code class="docutils literal notranslate"><span class="pre">venv</span></code>.</p>
<p>You can list the virtual environment only with,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>virtualenvs
</pre></div>
</div>
<p>And you can uninstall an environment with,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>uninstall<span class="w"> </span>my-environment
</pre></div>
</div>
</section>
</section>
<section id="adding-tests">
<span id="id4"></span><h3>Adding tests<a class="headerlink" href="#adding-tests" title="Link to this heading">#</a></h3>
<p>New tests can be added in any of the existing <code class="docutils literal notranslate"><span class="pre">tests/test_*.py</span></code> scripts. Tests
should be functions, contained within classes. The class contains a bunch of
related tests (e.g., metamers, metrics), and each test should ideally be a unit
test, only testing one thing. The classes should be named <code class="docutils literal notranslate"><span class="pre">TestSomething</span></code>, while
test functions should be named <code class="docutils literal notranslate"><span class="pre">test_something</span></code> in snakecase.</p>
<p>If you’re adding a substantial bunch of tests that are separate from the
existing ones, you can create a new test script. Its name must begin with
<code class="docutils literal notranslate"><span class="pre">test_</span></code>, it must have an <code class="docutils literal notranslate"><span class="pre">py</span></code> extension, and it must be contained within the
<code class="docutils literal notranslate"><span class="pre">tests</span></code> directory. Assuming you do that, our github actions will automatically
find it and add it to the tests-to-run.</p>
<p>Note that we also require that tests raise no warnings (see <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/pull/335">PR
#335</a>). This allows to stay
on top of deprecation warnings from our dependencies. There are several ways to
avoid warnings in tests, in order from most-to-least preferred:</p>
<ul class="simple">
<li><p>Write tests such that they avoid warnings. For example, all synthesis methods
call <a class="reference internal" href="../generated/plenoptic.tools.validate.html#plenoptic.tools.validate.validate_model" title="plenoptic.tools.validate.validate_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_model</span></code></a>, which will raise a warning if the model is in “training
mode” (e.g., <code class="docutils literal notranslate"><span class="pre">model.training</span></code> exists and is True). The default behavior of
<code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> objects is to be in training mode after initialization.
Thus, we call <code class="docutils literal notranslate"><span class="pre">model.eval</span></code> before passing a model to a synthesis method in a
test.</p></li>
<li><p>Selectively ignore the warning on a given test using
<code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.filterwarnings</span></code>. See our tests for an example or the <a class="reference external" href="https://docs.pytest.org/en/stable/how-to/capture-warnings.html#pytest-mark-filterwarnings">pytest
documentation</a> for an explanation.</p></li>
<li><p>Configure pytest to ignore the warning for all tests by updating
<code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> (they must come after <code class="docutils literal notranslate"><span class="pre">&quot;error&quot;</span></code>). These
should only include warnings that are temporary, such as deprecation warnings
that we raise or warnings that have been fixed upstream but not released yet.</p></li>
</ul>
</section>
<section id="testing-notebooks">
<h3>Testing notebooks<a class="headerlink" href="#testing-notebooks" title="Link to this heading">#</a></h3>
<p>We use <a class="reference external" href="https://jupyter.readthedocs.io/en/latest/running.html#using-a-command-line-interface">jupyter
execute</a>
to test our notebooks and make sure everything runs. You can run it locally to
try and debug some errors (though errors that result from environment issues
obviously will be harder to figure out locally); <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">execute</span></code> is part of
the standard <code class="docutils literal notranslate"><span class="pre">jupyter</span></code> install as long as you have <code class="docutils literal notranslate"><span class="pre">nbclient&gt;=0.5.5</span></code>.</p>
</section>
<section id="long-running-synthesis-and-tutorial-notebooks">
<h3>Long-running synthesis and tutorial notebooks<a class="headerlink" href="#long-running-synthesis-and-tutorial-notebooks" title="Link to this heading">#</a></h3>
<p>Occasionally, we want to include one or more synthesis calls within a tutorial
notebook that take a long time to run (for example, because we’re reproducing a
result from the literature). In order to avoid having the documentation build
take a long time, we instead write a regression test (in
<code class="docutils literal notranslate"><span class="pre">tests/test_uploaded_files.py</span></code>), which runs the synthesis, saves the output, and
compares it against a cached version stored in our OSF project. See
<code class="docutils literal notranslate"><span class="pre">tests/test_uploaded_files.py</span></code> to see how these tests look. Some important notes:</p>
<ul>
<li><p>The new tests should be added to the <code class="docutils literal notranslate"><span class="pre">TestTutorialNotebooks</span></code> class in
<code class="docutils literal notranslate"><span class="pre">test_uploaded_files.py</span></code>.</p></li>
<li><p>The synthesize call should be shown in the notebook, in a code block (unlike a
<code class="docutils literal notranslate"><span class="pre">code-cell</span></code>, <code class="docutils literal notranslate"><span class="pre">code-block</span></code> are not run). This <code class="docutils literal notranslate"><span class="pre">code-block</span></code> should be preceded
by a markdown comment giving the class and name of the corresponding test.
with a name that corresponds to the name of the test. So, if our test was
called <code class="docutils literal notranslate"><span class="pre">test_berardino_onoff</span></code> and found within the <code class="docutils literal notranslate"><span class="pre">TestDemoEigendistortion</span></code>
notebook, the corresponding code block should look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- TestDemoEigendistortion.test_berardino_onoff --&gt;
```{code-block} python
eigendist_f.synthesize(k=3, method=&quot;power&quot;, max_iter=2000)
```
</pre></div>
</div>
</li>
<li><p>This block will be checked whether it is part of the corresponding test
(literally, with <code class="docutils literal notranslate"><span class="pre">in</span></code>).</p>
<ul class="simple">
<li><p>If a variable has a different name in the block and in the test, the
preceding comment should include square brackets containing a
comma-separated list of the replacements: <code class="docutils literal notranslate"><span class="pre">&lt;!--</span> <span class="pre">TestDemoEigendistortion.test_berardino_onoff[eigendist_f:eig]</span> <span class="pre">--&gt;</span></code>.</p></li>
<li><p>If the test has lines we want to ignore (because they’re test-specific),
they should contain <code class="docutils literal notranslate"><span class="pre">lint_ignore</span></code> somewhere on the line, <strong>not in a
comment</strong> (e.g., <code class="docutils literal notranslate"><span class="pre">this_variable_lint_ignore</span> <span class="pre">=</span> <span class="pre">100</span></code> but not <code class="docutils literal notranslate"><span class="pre">this_variable</span> <span class="pre">=</span> <span class="pre">100</span> <span class="pre">#</span> <span class="pre">lint_ignore</span></code>).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/plenoptic/data/fetch.py</span></code> needs the hash and the URL slug of each new
file, so make sure to update them. The hash can be computed by calling
<code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">sha256</span> <span class="pre">path/to/file</span></code> on the command line.</p></li>
</ul>
<p>We have a linter that checks the conditions above.</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> does not run the tests found under <code class="docutils literal notranslate"><span class="pre">TestTutorialNotebooks</span></code> by default,
since they take a long time. In order to run them, you must explicitly set the
environment variable <code class="docutils literal notranslate"><span class="pre">RUN_REGRESSION_SYNTH=1</span></code> when calling pytest.</p>
<section id="exact-reproducibility">
<h4>Exact reproducibility<a class="headerlink" href="#exact-reproducibility" title="Link to this heading">#</a></h4>
<p>Exact reproducibility with pytorch is hard. See <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues/368">issue #368</a> for some details, but the tl;dr is: you should not expect to get the same outputs (or even, within floating point precision) when running synthesis for long enough (seems to be &gt; 1000 iterations) on devices with different CUDA versions and driver versions. Small differences in the output of e.g., <code class="docutils literal notranslate"><span class="pre">torch.einsum</span></code> / <code class="docutils literal notranslate"><span class="pre">torch.matmul</span></code> will lead to small differences in the gradient, which will accumulate and eventually lead to fairly different optimization outputs.</p>
<p>To deal with this, your regression tests should save their output into the <code class="docutils literal notranslate"><span class="pre">uploaded_files</span></code> folder after synthesis (and before checking). The contents of that folder will be made available as <a class="reference external" href="https://www.jenkins.io/doc/pipeline/tour/tests-and-artifacts/">Jenkins artifacts</a>, which you can then download after the test. This will allow you to download the output of any failing test, manually verify the results look good, and then upload them to the OSF to test against.</p>
</section>
</section>
<section id="test-parameterizations-and-fixtures">
<h3>Test parameterizations and fixtures<a class="headerlink" href="#test-parameterizations-and-fixtures" title="Link to this heading">#</a></h3>
<section id="parametrize">
<span id="id5"></span><h4>Parametrize<a class="headerlink" href="#parametrize" title="Link to this heading">#</a></h4>
<p>If you have many variants on a test you wish to run, you should probably make
use of pytests’ <code class="docutils literal notranslate"><span class="pre">parametrize</span></code> mark. There are many examples throughout our
existing tests (and see official <a class="reference external" href="https://docs.pytest.org/en/stable/parametrize.html">pytest
docs</a>), but the basic idea
is that you write a function that takes an argument and then use the
<code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> decorator to show pytest how to iterate over the
arguments. For example, instead of writing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_basic_1</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_basic_2</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
<p>You could write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_basic</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">test_val</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
        <span class="n">test_val</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">test_val</span>

</pre></div>
</div>
<p>This starts to become very helpful when you have multiple arguments you wish to
iterate over in this manner.</p>
</section>
<section id="fixtures">
<h4>Fixtures<a class="headerlink" href="#fixtures" title="Link to this heading">#</a></h4>
<p>If you are using an object that gets used in multiple tests (such as an image or
model), you should make use of fixtures to avoid having to load or initialize
the object multiple times. Look at <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> to see those fixtures available
for all tests, or you can write your own (though pay attention to the
<a class="reference external" href="https://docs.pytest.org/en/stable/fixture.html#scope-sharing-fixtures-across-classes-modules-packages-or-session">scope</a>).
For example, <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> contains several images that you can use for your
tests, such as <code class="docutils literal notranslate"><span class="pre">basic_stim</span></code>, <code class="docutils literal notranslate"><span class="pre">curie_img</span></code>, or <code class="docutils literal notranslate"><span class="pre">color_img</span></code>. To use them, simply
add them as arguments to your function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_img</span><span class="p">(</span><span class="n">curie_img</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">load_images</span><span class="p">(</span><span class="s1">&#39;data/curie.pgm&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">torch</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">curie_img</span><span class="p">)</span>
</pre></div>
</div>
<p>WARNING: If you’re using fixtures, make sure you don’t modify them in your test
(or you reset them to their original state at the end of the test). The fixture
is a single object that will get reused across tests, so modifying it will lead
to unexpected behaviors in other tests depending on which tests were run and
their execution order.</p>
</section>
<section id="combining-the-two">
<h4>Combining the two<a class="headerlink" href="#combining-the-two" title="Link to this heading">#</a></h4>
<p>You can combine fixtures and parameterization, which is helpful for when you
want to test multiple models with a synthesis method, for example. This is
slightly more complicated and relies on pytest’s <a class="reference external" href="https://docs.pytest.org/en/stable/example/parametrize.html#indirect-parametrization">indirect
parametrization</a>
(and requires <code class="docutils literal notranslate"><span class="pre">pytest&gt;=5.1.2</span></code> to work properly). For example, <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> has
a fixture, <code class="docutils literal notranslate"><span class="pre">model</span></code> <!-- skip-lint -->, which accepts a string and returns an instantiated model on
the right device. Use it like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SPyr&#39;</span><span class="p">,</span> <span class="s1">&#39;LNL&#39;</span><span class="p">],</span> <span class="n">indirect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_synth</span><span class="p">(</span><span class="n">curie_img</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="n">met</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">Metamer</span><span class="p">(</span><span class="n">curie_img</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">met</span><span class="o">.</span><span class="n">synthesize</span><span class="p">()</span>
</pre></div>
</div>
<p>This model will be run twice, once with the steerable pyramid model and once
with the Linear-Nonlinear model. See the <code class="docutils literal notranslate"><span class="pre">get_model</span></code> function in <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>
for the available strings. Note that unlike in the simple
<a class="reference internal" href="#parametrize"><span class="std std-ref">parametrize</span></a> example, we add the <code class="docutils literal notranslate"><span class="pre">indirect=True</span></code> argument here.
If we did not include that argument, <code class="docutils literal notranslate"><span class="pre">model</span></code> <!-- skip-lint --> would just be the strings <code class="docutils literal notranslate"><span class="pre">'SPyr'</span></code>
and <code class="docutils literal notranslate"><span class="pre">'LNL'</span></code>!</p>
</section>
</section>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">#</a></h2>
<section id="adding-documentation">
<span id="id6"></span><h3>Adding documentation<a class="headerlink" href="#adding-documentation" title="Link to this heading">#</a></h3>
<p>The amount and form of documentation that need to be added alongside a change
depends on the size of the submitted change. For a significant change (a new
model or synthesis method), please include a new tutorial notebook that walks
through how to use them. For enhancements of existing methods, you can probably
just modify the existing tutorials and add documentation. If unsure, ask!</p>
<p>Documentation in <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> is built using Sphinx on some of Flatiron’s Jenkins
runners and hosted on GitHub pages. If that means nothing to you, don’t worry!</p>
<p>All of our documentation is written as markdown files, with the extension <code class="docutils literal notranslate"><span class="pre">md</span></code>. We use the <a class="reference external" href="https://myst-parser.readthedocs.io/">myst parser</a>, along with <a class="reference external" href="https://myst-nb.readthedocs.io">myst-nb</a>. Both process markdown files, but <code class="docutils literal notranslate"><span class="pre">myst-nb</span></code> allows us to write <a class="reference external" href="https://myst-nb.readthedocs.io/en/latest/authoring/text-notebooks.html">text-based notebooks</a>, with python code that gets executed when the documentation is built.</p>
<p>The text-based notebooks are tutorials and show how to use the various functions and classes contained in the package. If you add or change a substantial amount of code, please add a tutorial showing how to use it.</p>
<p>In all markdown files, you should try to use sphinx’s cross-reference syntax to refer to code objects in API documentation whenever one is mentioned. For example, you should refer to the <a class="reference internal" href="../generated/plenoptic.synthesize.metamer.Metamer.html#plenoptic.synthesize.metamer.Metamer" title="plenoptic.synthesize.metamer.Metamer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Metamer</span></code></a> class as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{class}`~plenoptic.synthesize.metamer.Metamer`
</pre></div>
</div>
<p>You should similarly refer to code objects in other packages (e.g., pytorch and matplotlib), though the syntax is different. See <a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/syntax/cross-referencing.html#reference-roles">myst-parser docs</a> for more details and the existing documentation for more examples. As part of the pull request review process, we run linters that will check for missing cross-references. The only objects that can be referred to simply as <code class="docutils literal notranslate"><span class="pre">monospace</span></code> font are function arguments and generic attributes / method (e.g., saying that plenoptic models must have a <code class="docutils literal notranslate"><span class="pre">forward</span></code> <!-- skip-lint --> method). The linter will ignore all monospace font that have the word “argument” or “keyword” after them (e.g., “the <code class="docutils literal notranslate"><span class="pre">scales</span></code> keyword” or “the <code class="docutils literal notranslate"><span class="pre">scales</span></code> argument”) or an html comment containing “skip-lint” (e.g., “the <code class="docutils literal notranslate"><span class="pre">scales</span></code> <!-- skip-lint --> method”; html comments are not rendered in sphinx).</p>
<p>The regular markdown files contain everything else, especially discussions about why you should use some code in the package and the theory behind it, and should all be located in one of the subfolders within the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> directory. Decide which subfolder to place it in (ask for your help if you’re unsure) and add it to that subfolder’s <code class="docutils literal notranslate"><span class="pre">index.md</span></code> by adding the name of the file (without extension) to the <code class="docutils literal notranslate"><span class="pre">toctree</span></code> block.</p>
<p>In order for table of contents to look good, your <code class="docutils literal notranslate"><span class="pre">md</span></code> file must be well structured. All markdown files (text-based notebooks and regular) must have a single H1 header (you can have as many sub-headers as you’d like).</p>
<p>You should <a class="reference internal" href="#build-the-documentation"><span class="std std-ref">build the docs yourself</span></a> to ensure it looks correct before pushing.</p>
<section id="images-and-plots">
<h4>Images and plots<a class="headerlink" href="#images-and-plots" title="Link to this heading">#</a></h4>
<p>You can include images in <code class="docutils literal notranslate"><span class="pre">md</span></code> files in the documentation as well. Simply
place them in the <code class="docutils literal notranslate"><span class="pre">docs/images/</span></code> folder and use the <code class="docutils literal notranslate"><span class="pre">figure</span></code> role, e.g.,:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>:::{figure} images/path_to_my_image.svg
:figwidth: 100%
:alt: Alt-text describing my image.

Caption describing my image.
:::
</pre></div>
</div>
<p>To refer to it directly, you may want to use the <a class="reference external" href="https://docs.readthedocs.io/en/stable/guides/cross-referencing-with-sphinx.html#the-numref-role">numref
role</a>
(which has been enabled for our documentation).</p>
<p>If you have plots or other images generated by code that you wish to include,
you can include them in the file directly without either saving the output in
<code class="docutils literal notranslate"><span class="pre">docs/_static/images/</span></code> or turning the page into a notebook. This is useful if you want
to show something generated by code but the code itself isn’t the point. We
handle this with matplotlib’s <a class="reference external" href="https://matplotlib.org/stable/api/sphinxext_plot_directive_api.html" title="(in Matplotlib v3.10.8)"><span class="xref std std-doc">plot directive</span></a>
(which has already been enabled). Add a python script to <code class="docutils literal notranslate"><span class="pre">docs/scripts/</span></code> and
write a function that creates the matplotlib figure you wish to display. Then,
in your documentation, add:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>```{eval-rst}
.. plot:: scripts/path_to_my_script.py my_useful_plotting_function

   Caption describing what is in my plot.
```
</pre></div>
</div>
<p>Similar to figures, you can use <code class="docutils literal notranslate"><span class="pre">numref</span></code> to refer to plots as well.</p>
</section>
<section id="api-documentation">
<h4>API Documentation<a class="headerlink" href="#api-documentation" title="Link to this heading">#</a></h4>
<p>All public functions and classes must be included on the API documentation page.
Therefore, if you add a new public function or class, make sure to add it to
<code class="docutils literal notranslate"><span class="pre">docs/api.rst</span></code> in an appropriate location. If this is not done,
<code class="docutils literal notranslate"><span class="pre">linting/check_apidocs.py</span></code> will fail (this check is included in our pre-commit
config and thus is required to pass for a PR to merge).</p>
<p>If you add a new source file (e.g., <code class="docutils literal notranslate"><span class="pre">src/plenoptic/synthesize/new_method.py</span></code>),
you will also need to add it to <code class="docutils literal notranslate"><span class="pre">docs/api_modules.rst</span></code>. If this is not done,
sphinx will raise an error when building the documentation. You also need to add
that file to the hidden toctree at the top of <code class="docutils literal notranslate"><span class="pre">docs/api.rst</span></code>.</p>
</section>
</section>
<section id="docstrings">
<span id="id7"></span><h3>Docstrings<a class="headerlink" href="#docstrings" title="Link to this heading">#</a></h3>
<p>All public-facing functions and classes should have complete docstrings, which
start with a one-line short summary of the function, a medium-length description
of the function / class and what it does, and a complete description of all
arguments and return values. Math should be included in a <code class="docutils literal notranslate"><span class="pre">Notes</span></code> section when
necessary to explain what the function is doing, and references to primary
literature should be included in a <code class="docutils literal notranslate"><span class="pre">References</span></code> section when appropriate.
Docstrings should be relatively short, providing the information necessary for a
user to use the code. Longer discussions of why you would use one method over
another, an explanation of the theory behind a method, and extended examples
should instead be part of the tutorials or documentation.</p>
<p>Private functions and classes should have sufficient explanation that other
developers know what the function / class does and how to use it, but do not
need to be as extensive.</p>
<p>We follow the <a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/">numpydoc</a> conventions
for docstring structure.</p>
</section>
<section id="doctests">
<h3>Doctests<a class="headerlink" href="#doctests" title="Link to this heading">#</a></h3>
<p>All public-facing functions and classes should include <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a>, which are the standard python way of showing short code examples in docstrings. These should be included in their own <code class="docutils literal notranslate"><span class="pre">Examples</span></code> section of the docstring. Every docstring should include at least one example, which shows the most common way of interacting with the function / class. Additional examples should be included where helpful, to show other common ways of interacting with the object (e.g., setting optional arguments), with brief descriptions describing what each example is doing.</p>
<p>A function’s Examples section must run independently from those of other functions (i.e., it can’t reuse an object defined in a different function), but different blocks within the section can depend on each other (so that e.g., you don’t have to reimport plenoptic in each block).</p>
<p>Our doctests are tested using <a class="reference external" href="https://docs.pytest.org/en/stable/how-to/doctest.html">pytest</a> in our CI (the <code class="docutils literal notranslate"><span class="pre">doctests</span></code> action) and sphinx builds them as part of the documentation (which is part of the Jenkins CI step). Both are required to pass before any PR will be merged. Some notes about this:</p>
<ul>
<li><p>If you would like to include a figure, use matplotlib’s <a class="reference external" href="https://matplotlib.org/stable/api/sphinxext_plot_directive_api.html" title="(in Matplotlib v3.10.8)"><span class="xref std std-doc">plot directive</span></a>. That means, your example should be structured like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">plot</span><span class="p">::</span>
   <span class="p">:</span><span class="n">context</span><span class="p">:</span> <span class="n">close</span><span class="o">-</span><span class="n">figs</span>

   <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">plenoptic</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">po</span>
   <span class="o">&gt;&gt;&gt;</span> <span class="c1"># more example code here...</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">:context:</span> <span class="pre">close-figs</span></code> is important to make sure that the figures are independent across examples (this should probably be <code class="docutils literal notranslate"><span class="pre">:context:</span> <span class="pre">reset</span></code> for the first plot directive in a given docstring, <code class="docutils literal notranslate"><span class="pre">close-figs</span></code> thereafter). However, unfortunately,  only sphinx knows how to interpret this directive; pytest ignores it. That means the doctests must be written in such a way that they will not fail if they are run with open figures lying around. One could easily start their doctests by closing any open figures, but this generally goes against the principle of making these examples as compact and useful as possible. Unfortunately, I have not found a good general solution here.</p></li>
<li><p>sphinx <strong>only</strong> runs the blocks contained within the plot directive. That means, if, for example, you have two blocks in the doctest, only the second of which creates a plot, both of them need to be contained within a plot directive so that the second block can reuse objects (including the imported plenoptic library!) from the first. That is, the following will fail:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Examples</span>
<span class="o">--------</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">plenoptic</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">po</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">einstein</span><span class="p">()</span>

<span class="n">And</span> <span class="n">now</span> <span class="n">we</span> <span class="n">display</span> <span class="n">the</span> <span class="n">image</span><span class="p">:</span>

<span class="o">..</span> <span class="n">plot</span><span class="p">::</span>
   <span class="p">:</span><span class="n">context</span><span class="p">:</span> <span class="n">reset</span>

   <span class="o">&gt;&gt;&gt;</span> <span class="n">po</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p>whereas the following will succeed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Examples</span>
<span class="o">--------</span>
<span class="o">..</span> <span class="n">plot</span><span class="p">::</span>
   <span class="p">:</span><span class="n">reset</span><span class="p">:</span> <span class="n">reset</span>

   <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">plenoptic</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">po</span>
   <span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">einstein</span><span class="p">()</span>

<span class="n">And</span> <span class="n">now</span> <span class="n">we</span> <span class="n">display</span> <span class="n">the</span> <span class="n">image</span><span class="p">:</span>

<span class="o">..</span> <span class="n">plot</span><span class="p">::</span>
   <span class="p">:</span><span class="n">context</span><span class="p">:</span> <span class="n">close</span><span class="o">-</span><span class="n">figs</span>

   <span class="o">&gt;&gt;&gt;</span> <span class="n">po</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the second block cannot have <code class="docutils literal notranslate"><span class="pre">:context:</span> <span class="pre">reset</span></code> or you will be unable to use the objects from the first block!</p>
<p>This only affects sphinx. pytest ignores the plot directive and so either structure will pass.</p>
</li>
</ul>
</section>
<section id="build-the-documentation">
<span id="id8"></span><h3>Build the documentation<a class="headerlink" href="#build-the-documentation" title="Link to this heading">#</a></h3>
<p>NOTE: If you just want to read the documentation, you do not need to do this;
documentation is built automatically, pushed to the
<a class="reference external" href="https://github.com/plenoptic-org/plenoptic-documentation">plenoptic-documentation</a>
github repo and published at <a class="reference external" href="http://docs.plenoptic.org/">http://docs.plenoptic.org/</a>.</p>
<p>However, it can be built locally as well. You would do this if you’ve made changes locally to the documentation (or the docstrings) that you would like to examine before pushing. All additional requirements are included in the <code class="docutils literal notranslate"><span class="pre">[docs]</span></code> optional dependency bundle, which you can install with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">plenoptic[docs]</span></code>.</p>
<p>Then, to build the documentation, run: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-C</span> <span class="pre">docs</span> <span class="pre">html</span> <span class="pre">O=&quot;-j</span> <span class="pre">auto&quot;</span></code>. (<code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">auto</span></code> tells sphinx to parallelize the build, using as many cores as possible, a specific number can be set.)</p>
<p>By default, the text-based notebooks (see <a class="reference internal" href="#adding-documentation"><span class="std std-ref">earlier</span></a>) are not run because they take a longish time to do so, especially if you do not have a GPU. In order to run all of them, prepend <code class="docutils literal notranslate"><span class="pre">RUN_NB=1</span></code> to the <code class="docutils literal notranslate"><span class="pre">make</span></code> command above. In order to run specific notebooks, set <code class="docutils literal notranslate"><span class="pre">RUN_NB</span></code> to a globbable comma-separated string in the above, e.g., <code class="docutils literal notranslate"><span class="pre">RUN_NB=Metamer,MAD</span></code> to run <code class="docutils literal notranslate"><span class="pre">docs/user_guide/synthesis/Metamer</span></code>, <code class="docutils literal notranslate"><span class="pre">docs/user_guide/synthesis/MAD_Competition_1</span></code>, and <code class="docutils literal notranslate"><span class="pre">docs/user_guide/synthesis/MAD_Competition_2</span></code>.</p>
<p>Additionally, our docstrings have a variety of Examples blocks that are run by sphinx in order to render plots in the documentation, which can take a while to run. You can temporarily disable these by prepending <code class="docutils literal notranslate"><span class="pre">SKIP_MPL=1</span></code> to the <code class="docutils literal notranslate"><span class="pre">make</span></code> command. This will cause <code class="docutils literal notranslate"><span class="pre">docutils</span></code> to raise an error every time it encounters a <a class="reference external" href="https://matplotlib.org/stable/api/sphinxext_plot_directive_api.html"><code class="docutils literal notranslate"><span class="pre">plot</span></code> directive</a>, and so the build will appear to fail. However, the output will be rendered correctly (with the exception of those <code class="docutils literal notranslate"><span class="pre">plot</span></code> blocks), and so this can be useful for rapidly viewing changes locally when editing other parts of the documentation. In order to ensure the documentation build completes without any warnings or errors, you should build the docs normally before pushing.</p>
<p>The index page of the documentation will then be located at
<code class="docutils literal notranslate"><span class="pre">docs/_build/html/index.html</span></code>, open it in your browser to navigate
around.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="synthesis.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Synthesis object design</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-versions">Supported versions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-to-the-code">Contributing to the code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contribution-workflow">Contribution workflow</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-development-environment">Creating a development environment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-new-branch">Creating a new branch</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-your-change-back-to-plenoptic">Contributing your change back to plenoptic</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-style-and-linting">Code Style and Linting</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-ruff">Using Ruff</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#formatting">Formatting:</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#using-ruff-for-linting">Using Ruff for Linting:</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ignoring-ruff-linting">Ignoring Ruff Linting</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-style-guide-recommendations">General Style Guide Recommendations:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-commit-hooks-identifying-simple-issues-before-submission-to-code-review-and-how-to-ignore-those">Pre-Commit Hooks:  Identifying simple issues before submission to code review (and how to ignore those)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-models-or-synthesis-methods">Adding models or synthesis methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#releases">Releases</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-pytest-with-non-standard-cache-directories">Running pytest with non-standard cache directories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-nox-to-simplify-testing-and-linting">Using nox to simplify testing and linting</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-python-version-testing-with-pyenv">Multi-python version testing with pyenv</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-tests">Adding tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-notebooks">Testing notebooks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#long-running-synthesis-and-tutorial-notebooks">Long-running synthesis and tutorial notebooks</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exact-reproducibility">Exact reproducibility</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-parameterizations-and-fixtures">Test parameterizations and fixtures</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parametrize">Parametrize</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fixtures">Fixtures</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-the-two">Combining the two</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-documentation">Adding documentation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#images-and-plots">Images and plots</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docstrings">Docstrings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#doctests">Doctests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-the-documentation">Build the documentation</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2019-2025, Plenoptic authors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>