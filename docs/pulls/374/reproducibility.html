

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reproducibility and Compatibility &mdash; plenoptic 1.3.1.dev347 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=a2d047e6" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=93a40f78"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=35a8b989"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="plenoptic" href="api/modules.html" />
    <link rel="prev" title="Tips and Tricks" href="tips.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            plenoptic
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basic concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Using Jupyter to Run Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="conceptual_intro.html">Conceptual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Model requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation Guide and Bibliography</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Synthesis method introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/Eigendistortions.html">Eigendistortions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/MAD_Competition_1.html">MAD Competition Conceptual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/MAD_Competition_2.html">MAD Competition Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/Metamer.html">Metamers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models and metrics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/models/Perceptual_distance.html">Perceptual distance</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/models/Portilla_Simoncelli.html">Portilla-Simoncelli Texture Metamer</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/models/Steerable_Pyramid.html">Steerable Pyramid</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Synthesis method examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/applications/Demo_Eigendistortion.html">Reproducing Berardino et al., 2017 (Eigendistortions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/applications/Original_MAD.html">Reproducing Wang and Simoncelli, 2008 (MAD Competition)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="synthesis.html">Synthesis object design</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips and Tricks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reproducibility and Compatibility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reprodubility">Reprodubility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compatibility">Compatibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#breaking-change-to-load-in-plenoptic-1-2">Breaking change to load in plenoptic 1.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#futurewarning-in-load-in-plenoptic-1-4">FutureWarning in load in plenoptic 1.4</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/advanced/Display.html">Display and animate functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/advanced/Synthesis_extensions.html">Extending existing synthesis objects</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">plenoptic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Reproducibility and Compatibility</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/reproducibility.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="reproducibility-and-compatibility">
<span id="reproduce"></span><h1>Reproducibility and Compatibility<a class="headerlink" href="#reproducibility-and-compatibility" title="Link to this heading"></a></h1>
<section id="reprodubility">
<h2>Reprodubility<a class="headerlink" href="#reprodubility" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> includes several results reproduced from the literature and aims to facilitate reproducible research. However, we are limited by our dependencies and PyTorch, in particular, comes with the <a class="reference external" href="https://pytorch.org/docs/stable/notes/randomness.html">caveat</a> that “Completely reproducible results are not guaranteed across PyTorch releases, individual commits, or different platforms. Furthermore, results may not be reproducible between CPU and GPU executions, even when using identical seeds” (quote from the <a class="reference external" href="https://pytorch.org/docs/1.12/notes/randomness.html">v1.12</a> documentation).</p>
<p>This means that you should note the <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> version and the <code class="docutils literal notranslate"><span class="pre">pytorch</span></code> version your synthesis used in order to guarantee reproducibility (some versions of <code class="docutils literal notranslate"><span class="pre">pytorch</span></code> will give consistent results with each other, but it’s not guaranteed and hard to predict). We do not believe reproducibility depends on the python version or any other packages.</p>
<p>However, in general, the CPU and GPU will always give different results, and you may also end up with different outputs on GPU devices with different CUDA or driver versions.</p>
<p>We reproduce several results from the literature and validate these as part of our tests. We are therefore aware of the following changes that broke reproducibility:</p>
<ul class="simple">
<li><p>PyTorch 1.8 and 1.9 give the same results, but 1.10 changes results in changes, probably due to the difference in how the sub-gradient for <code class="docutils literal notranslate"><span class="pre">torch.min</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.max</span></code> are computed (<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/pull/96#issuecomment-973318291">see this PR</a>).</p></li>
<li><p>PyTorch 1.12 breaks reproducibility with 1.10 and 1.11, unclear why (<a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues/165">see this issue</a>).</p></li>
</ul>
</section>
<section id="compatibility">
<span id="compat"></span><h2>Compatibility<a class="headerlink" href="#compatibility" title="Link to this heading"></a></h2>
<p>While we try to maintain compatibility between <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> versions, <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> is under active development and so the API of its objects may change. Similar to the comments on reproducibility above, we cannot guarantee that you will be able to load a <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> object saved with a different version of <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> or <code class="docutils literal notranslate"><span class="pre">pytorch</span></code>. The following notes known breaking changes and how, if possible, to load your object anyway.</p>
<p>Note that you should always be able to load in the saved object using <code class="docutils literal notranslate"><span class="pre">pytorch</span></code> directly, like so:</p>
<p>If your object was saved in plenoptic 1.1 or earlier:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="n">plen_object</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;saved_plen_object.pt&quot;</span><span class="p">,</span> <span class="n">weights_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that setting <code class="docutils literal notranslate"><span class="pre">weights_only=False</span></code> allows arbitrary code execution and thus is unsafe — only run the above code when you know the contents of and trust the saved file! (See <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues/313">related issue</a> for more details.)</p>
<p>If your object was saved in plenoptic 1.2 or later, <code class="docutils literal notranslate"><span class="pre">weights_only=False</span></code> is unnecessary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="n">plen_object</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;saved_plen_object.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The object you have loaded is a dictionary with strings as keys. Once you’ve loaded your object, you can extract the outcome of your synthesis (e.g., by looking at the <code class="docutils literal notranslate"><span class="pre">&quot;metamer&quot;</span></code> key). <a class="reference external" href="https://github.com/plenoptic-org/plenoptic/issues/new/choose">Post an issue</a> if you need help!</p>
<section id="breaking-change-to-load-in-plenoptic-1-2">
<h3>Breaking change to load in plenoptic 1.2<a class="headerlink" href="#breaking-change-to-load-in-plenoptic-1-2" title="Link to this heading"></a></h3>
<p>Prior to plenoptic 1.2, we were saving python functions and pytorch optimization objects. This was incompatible with a breaking change made to <a class="reference external" href="https://docs.pytorch.org/docs/stable/generated/torch.load.html#torch.load" title="(in PyTorch v2.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.load</span></code></a> in <code class="docutils literal notranslate"><span class="pre">pytorch</span></code> version 2.6. Unfortunately, there is no way to make an object saved prior to 1.2 compatible with later <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> releases; see <a class="reference internal" href="#compat"><span class="std std-ref">Compatibility</span></a> for how to extract the outputs of your synthesis.</p>
</section>
<section id="futurewarning-in-load-in-plenoptic-1-4">
<h3>FutureWarning in load in plenoptic 1.4<a class="headerlink" href="#futurewarning-in-load-in-plenoptic-1-4" title="Link to this heading"></a></h3>
<p>A small change was made to the <a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.metamer.Metamer" title="plenoptic.synthesize.metamer.Metamer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Metamer</span></code></a> and <a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.mad_competition.MADCompetition" title="plenoptic.synthesize.mad_competition.MADCompetition"><code class="xref py py-class docutils literal notranslate"><span class="pre">MADCompetition</span></code></a> APIs in <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> 1.4. You will be able to load <a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.metamer.Metamer" title="plenoptic.synthesize.metamer.Metamer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Metamer</span></code></a> and <a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.mad_competition.MADCompetition" title="plenoptic.synthesize.mad_competition.MADCompetition"><code class="xref py py-class docutils literal notranslate"><span class="pre">MADCompetition</span></code></a> objects saved with version 1.2 and 1.3 for some time, but doing so will raise a <code class="docutils literal notranslate"><span class="pre">FutureWarning</span></code> and this compatibility will eventually be removed.</p>
<p>In order to make an object compatible with future releases, you can either load it in with <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> 1.4 and re-save it, or do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="n">old_save</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;old_save.pt&quot;</span><span class="p">)</span>
<span class="n">old_save</span><span class="p">[</span><span class="s2">&quot;_current_loss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">old_save</span><span class="p">,</span> <span class="s2">&quot;old_save.pt&quot;</span><span class="p">)</span>
<span class="c1"># and then load as normal</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tips.html" class="btn btn-neutral float-left" title="Tips and Tricks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api/modules.html" class="btn btn-neutral float-right" title="plenoptic" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2025, Plenoptic authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>