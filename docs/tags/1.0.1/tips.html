

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tips and Tricks &mdash; plenoptic 1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=292eb321"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reproducibility" href="reproducibility.html" />
    <link rel="prev" title="Synthesis object design" href="synthesis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            plenoptic
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basic concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="conceptual_intro.html">Conceptual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Model requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/00_quickstart.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Synthesis method introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/02_Eigendistortions.html">Eigendistortions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/05_Geodesics.html">Representational Geodesic</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/06_Metamer.html">Metamers</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/07_Simple_MAD.html">MAD Competition Conceptual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/intro/08_MAD_Competition.html">MAD Competition Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models and metrics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/models/03_Steerable_Pyramid.html">Steerable Pyramid</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/models/04_Perceptual_distance.html">Perceptual distance</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/models/Metamer-Portilla-Simoncelli.html">Portilla-Simoncelli Texture Metamer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Synthesis method examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/applications/09_Original_MAD.html">Reproducing Wang and Simoncelli, 2008 (MAD Competition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/applications/Demo_Eigendistortion.html">Reproducing Berardino et al., 2017 (Eigendistortions)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="synthesis.html">Synthesis object design</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tips and Tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-does-synthesis-take-so-long">Why does synthesis take so long?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimization-is-hard">Optimization is hard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#none-of-the-existing-synthesis-methods-meet-my-needs">None of the existing synthesis methods meet my needs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reproducibility.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/advanced/Display.html">Display and animate functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/advanced/Synthesis_extensions.html">Extending existing synthesis objects</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">plenoptic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tips and Tricks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tips.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tips-and-tricks">
<span id="tips"></span><h1>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Link to this heading"></a></h1>
<section id="why-does-synthesis-take-so-long">
<h2>Why does synthesis take so long?<a class="headerlink" href="#why-does-synthesis-take-so-long" title="Link to this heading"></a></h2>
<p>Synthesis can take a while to run, especially if you are trying to synthesize a
large image or using a complicated model. The following might help:</p>
<ul class="simple">
<li><p>Reducing the amount of time your model’s forward pass takes is the easiest way
to reduce the overall duration of synthesis, as the forward pass is called
many, many times over synthesis. Try using python’s <a class="reference external" href="https://docs.python.org/3/library/profile.html">built-in profiling tools</a> to check which part of your
model’s forward pass is taking the longest, and try to make those parts more
efficient. Jupyter also has nice <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">profiling tools</a>.
For example, if you have for loops in your code, try and replace them with
matrix operations and <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.einsum.html">einsum</a>.</p></li>
<li><p>If you have access to a GPU, use it! If your inputs are on the GPU before
initializing the synthesis methods, the synthesis methods will also make use
of the GPU. You can also move the <code class="docutils literal notranslate"><span class="pre">plenoptic</span></code>’s synthesis methods and models
over to the GPU after initialization using the <code class="docutils literal notranslate"><span class="pre">.to()</span></code> method.</p></li>
</ul>
</section>
<section id="optimization-is-hard">
<h2>Optimization is hard<a class="headerlink" href="#optimization-is-hard" title="Link to this heading"></a></h2>
<p>You should double-check whether synthesis has successfully completed before
interpreting the outputs or using them in any experiments. This is not necessary
for eigendistortions (see its <a class="reference external" href="tutorials/02_Eigendistortions.html">notebook</a>
for more details on why), but is necessary for all the iterative optimization
methods.</p>
<ul class="simple">
<li><p>For metamers, this means double-checking that the difference between the model
representation of the metamer and the target image is small enough. If your
model’s representation is multi-scale, trying coarse-to-fine optimization may
help (see <a class="reference external" href="tutorials/06_Metamer.html#Coarse-to-fine-optimization">notebook</a>
for details).</p></li>
<li><p>For MAD competition, this means double-checking that the reference metric is
constant and that the optimized metric has converged at a lower or higher
value (depending on the value of <code class="docutils literal notranslate"><span class="pre">synthesis_target</span></code>); use
<a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.mad_competition.plot_synthesis_status" title="plenoptic.synthesize.mad_competition.plot_synthesis_status"><code class="xref py py-func docutils literal notranslate"><span class="pre">plenoptic.synthesize.mad_competition.plot_synthesis_status()</span></code></a> to
visualize these values. You will likely need to spend time trying out
different values for the <code class="docutils literal notranslate"><span class="pre">metric_tradeoff_lambda</span></code> argument set during
initialization to achieve this.</p></li>
<li><p>For geodesics, check that your geodesic’s path energy is small enough and that
the deviation from a straight line in representational space is minimal (use
<a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.geodesic.plot_deviation_from_line" title="plenoptic.synthesize.geodesic.plot_deviation_from_line"><code class="xref py py-func docutils literal notranslate"><span class="pre">plenoptic.synthesize.geodesic.plot_deviation_from_line()</span></code></a>)</p></li>
</ul>
<p>For all of the above, if synthesis has not found a good solution, you may need
to run synthesis longer, use a learning-rate scheduler, change the learning
rate, or try different optimizers. Each method’s <code class="docutils literal notranslate"><span class="pre">objective_function</span></code> method
captures the value that we are trying to minimize, but may contain other values
(such as the penalty on allowed range values).</p>
<p>Additionally, it may be helpful to visualize the progression of synthesis, using
each synthesis method’s <code class="docutils literal notranslate"><span class="pre">animate</span></code> or <code class="docutils literal notranslate"><span class="pre">plot_synthesis_status</span></code> helper
functions (e.g., <a class="reference internal" href="api/plenoptic.synthesize.html#plenoptic.synthesize.metamer.plot_synthesis_status" title="plenoptic.synthesize.metamer.plot_synthesis_status"><code class="xref py py-func docutils literal notranslate"><span class="pre">plenoptic.synthesize.metamer.plot_synthesis_status()</span></code></a>).</p>
</section>
<section id="none-of-the-existing-synthesis-methods-meet-my-needs">
<h2>None of the existing synthesis methods meet my needs<a class="headerlink" href="#none-of-the-existing-synthesis-methods-meet-my-needs" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">plenoptic</span></code> provides four synthesis methods, but you may find you wish to do
something slightly outside the capabilities of the existing methods. There are
generally two ways to do this: by tweaking your model or by extending one of the
methods.</p>
<ul class="simple">
<li><p>See the <a class="reference external" href="tutorials/Metamer-Portilla-Simoncelli.html">Portilla-Simoncelli texture model notebook</a> for examples on how to get
different metamer results by tweaking your model or extending the <code class="docutils literal notranslate"><span class="pre">Metamer</span></code>
class.</p></li>
<li><p>The coarse-to-fine optimization, discussed in the <a class="reference external" href="tutorials/06_Metamer.html#Coarse-to-fine-optimization">metamer notebook</a>, is an example of
changing optimization by extending the <code class="docutils literal notranslate"><span class="pre">Metamer</span></code> class.</p></li>
<li><p>The <a class="reference external" href="tutorials/Synthesis_extensions.html">Synthesis extensions notebook</a>
contains a discussion focused on this as well.</p></li>
</ul>
<p>If you extend a method successfully or would like help making it work, please
let us know by posting a <a class="reference external" href="https://github.com/Flatiron-CCN/plenoptic/discussions">discussion!</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="synthesis.html" class="btn btn-neutral float-left" title="Synthesis object design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reproducibility.html" class="btn btn-neutral float-right" title="Reproducibility" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Lab for Computational Vision.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>